<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Trace</title>
<meta name="description" content="Documentation of Coq module Trace" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Trace</h1>
<div class="coq">
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span>  <span class="id">Vellvm.Classes</span> <span class="id">Vellvm.Util</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="kwd">Program</span> <span class="id">Classical</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">paco</span>.<br/>
<br/>
<span class="kwd">Set</span> <span class="kwd">Implicit</span> <span class="id">Arguments</span>.<br/>
<span class="kwd">Set</span> <span class="id">Contextual</span> <span class="kwd">Implicit</span>.<br/>
<br/>
<div class="doc">An <span class="bracket"><span class="id">M</span> <span class="id">E</span> <span class="id">X</span></span> is the denotation of a program as coinductive (possibly
    infinite) tree where the leaves are labeled with <span class="bracket"><span class="id">X</span></span> and every node
    is either a <span class="bracket"><span class="id">Tau</span></span> node with one child, or a branching node <span class="bracket"><span class="id">Vis</span></span>
    with a visible event <span class="bracket"><span class="id">E</span> <span class="id">Y</span></span> that branches on the values of <span class="bracket"><span class="id">Y</span></span>. </div>
<span class="kwd">CoInductive</span> <span class="id">M</span> (<span class="id">Event</span> : <span class="kwd">Type</span> -&gt; <span class="kwd">Type</span>) <span class="id">X</span> := <br/>
| <span class="id">Ret</span> (<span class="id">x</span>:<span class="id">X</span>)<br/>
| <span class="id">Vis</span> {<span class="id">Y</span>: <span class="kwd">Type</span>} (<span class="id">e</span> : <span class="id">Event</span> <span class="id">Y</span>) (<span class="id">k</span> : <span class="id">Y</span> -&gt; <span class="id">M</span> <span class="id">Event</span> <span class="id">X</span>)<br/>
| <span class="id">Tau</span> (<span class="id">k</span>: <span class="id">M</span> <span class="id">Event</span> <span class="id">X</span>)<br/>
| <span class="id">Err</span> (<span class="id">s</span>:<span class="id">String.string</span>)<br/>
.<br/>
<div class="doc">Note: One could imagine an alternative definition with an explicit
    Bind constructor (and a Prim constructor), but this might not be
    as nice / might not work at all -- this way makes productivity
    easier to deal with.  (Also, this one can be turned into a real
    monad.)  We should compare at some point. </div>
<br/>
<div class="doc">N.b. This is related to the Free Monad construction, which is not
    possible with Coq due to the positivity requirement. But when
    the functor that we want to build the Free Monad from is
    representable (or "Naperian", as it is called by Peter Hancock),
    we can use this encoding to avoid the problem.
    Update: that comment would apply only if we had
    <span class="bracket"><span class="id">Event</span> : <span class="kwd">Type</span> -&gt; <span class="kwd">Type</span></span> and <span class="bracket"><span class="id">Vis</span> (<span class="id">Event</span> -&gt; <span class="id">M</span> <span class="id">Event</span> <span class="id">X</span>)</span>.
    </div>
<br/>
<div class="doc"><span class="bracket"><span class="id">M</span></span> is known as the "Freer monad".
    "Freer Monads, More Extensible Effects",
    Oleg Kiselyov, Hiromi Ishii.
    The <span class="bracket"><span class="id">Vis</span></span> constructor corresponds to a free functor construction
    also called Co-Yoneda or left Kan extension.
    Note that <span class="bracket"><span class="id">Event</span></span> is meant to be an indexed type, and generally
    not a functor, but we have a monad in any case. </div>
<br/>
<div class="doc">The existence of <span class="bracket"><span class="id">spin</span></span> makes this not quite free:
    amounts more or less to an additional <span class="bracket"><span class="id">Event</span> <span class="id">Void</span></span>
    constructor.  </div>
<br/>
<div class="doc">In order to unfold a cofixpoint we have to rewrite it with
    <span class="bracket"><span class="id">matchM</span></span>.  (Is this relevant only in proofs?  Maybe it should be
    defined near the Ltac that uses it.) </div>
<span class="kwd">Definition</span> <span class="id">idM</span> <span class="id">E</span> <span class="id">X</span> (<span class="id">i</span>: <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">i</span> <span class="kwd">with</span> <br/>
&nbsp;&nbsp;| <span class="id">Ret</span> <span class="id">x</span> =&gt; <span class="id">Ret</span> <span class="id">x</span><br/>
&nbsp;&nbsp;| <span class="id">Vis</span> <span class="id">e</span> <span class="id">k</span> =&gt; <span class="id">Vis</span> <span class="id">e</span> <span class="id">k</span><br/>
&nbsp;&nbsp;| <span class="id">Tau</span> <span class="id">k</span> =&gt; <span class="id">Tau</span> <span class="id">k</span><br/>
&nbsp;&nbsp;| <span class="id">Err</span> <span class="id">s</span> =&gt; <span class="id">Err</span> <span class="id">s</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<span class="kwd">Lemma</span> <span class="id">matchM</span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">X</span> (<span class="id">i</span>: <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>), <span class="id">i</span> = <span class="id">idM</span> <span class="id">i</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof148')">Proof.</div>
<div class="proofscript" id="proof148">
 <span class="tactic">destruct</span> <span class="id">i</span>; <span class="tactic">auto</span>. Qed.</div>
<br/>
<div class="doc"><span class="bracket"><span class="id">M</span> <span class="id">E</span></span> forms a <span class="bracket"><span class="id">Monad</span></span> </div>
<span class="kwd">Definition</span> <span class="id">bindM</span> {<span class="id">E</span> <span class="id">X</span> <span class="id">Y</span>} (<span class="id">s</span>: <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>) (<span class="id">t</span>: <span class="id">X</span> -&gt; <span class="id">M</span> <span class="id">E</span> <span class="id">Y</span>) : <span class="id">M</span> <span class="id">E</span> <span class="id">Y</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cofix</span> <span class="id">go</span> (<span class="id">s</span> : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>) := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">s</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Ret</span> <span class="id">x</span> =&gt; <span class="id">Tau</span> (<span class="id">t</span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Vis</span> <span class="id">e</span> <span class="id">k</span> =&gt; <span class="id">Vis</span> <span class="id">e</span> (<span class="kwd">fun</span> <span class="id">y</span> =&gt; <span class="id">go</span> (<span class="id">k</span> <span class="id">y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Tau</span> <span class="id">k</span> =&gt; <span class="id">Tau</span> (<span class="id">go</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Err</span> <span class="id">s</span> =&gt; <span class="id">Err</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">in</span> <span class="id">go</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">mapM</span> {<span class="id">E</span> <span class="id">X</span> <span class="id">Y</span>} (<span class="id">f</span>:<span class="id">X</span> -&gt; <span class="id">Y</span>) (<span class="id">s</span>: <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>) : <span class="id">M</span> <span class="id">E</span> <span class="id">Y</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">cofix</span> <span class="id">go</span> (<span class="id">s</span> : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">s</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Ret</span> <span class="id">x</span> =&gt; <span class="id">Ret</span> (<span class="id">f</span> <span class="id">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Vis</span> <span class="id">e</span> <span class="id">k</span> =&gt; <span class="id">Vis</span> <span class="id">e</span> (<span class="kwd">fun</span> <span class="id">y</span> =&gt; <span class="id">go</span> (<span class="id">k</span> <span class="id">y</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Tau</span> <span class="id">k</span> =&gt; <span class="id">Tau</span> (<span class="id">go</span> <span class="id">k</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Err</span> <span class="id">s</span> =&gt; <span class="id">Err</span> <span class="id">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">in</span> <span class="id">go</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">Instance</span> <span class="id">functor_M</span> {<span class="id">E</span>} : <span class="id">Functor</span> (<span class="id">M</span> <span class="id">E</span>) := (@<span class="id">mapM</span> <span class="id">E</span>).<br/>
<span class="kwd">Instance</span> <span class="id">monad_M</span> {<span class="id">E</span>} : (@<span class="id">Monad</span> (<span class="id">M</span> <span class="id">E</span>)) (@<span class="id">mapM</span> <span class="id">E</span>) := { <span class="id">mret</span> <span class="id">X</span> <span class="id">x</span> := <span class="id">Ret</span> <span class="id">x</span>; <span class="id">mbind</span> := @<span class="id">bindM</span> <span class="id">E</span> }.<br/>
<br/>
<br/>
<span class="kwd">CoInductive</span> <span class="id">equiv</span> {<span class="id">E</span> <span class="id">X</span>} : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span> -&gt; <span class="id">M</span> <span class="id">E</span> <span class="id">X</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">equiv_Ret</span> : <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">equiv</span> (<span class="id">Ret</span> <span class="id">x</span>) (<span class="id">Ret</span> <span class="id">x</span>)<br/>
| <span class="id">equiv_Vis</span> : <span class="kwd">forall</span> {<span class="id">Y</span>} <span class="id">e</span> <span class="id">k1</span> <span class="id">k2</span>, (<span class="kwd">forall</span> (<span class="id">v</span>:<span class="id">Y</span>), <span class="id">equiv</span> (<span class="id">k1</span> <span class="id">v</span>) (<span class="id">k2</span> <span class="id">v</span>)) -&gt; <span class="id">equiv</span> (<span class="id">Vis</span> <span class="id">e</span> <span class="id">k1</span>) (<span class="id">Vis</span> <span class="id">e</span> <span class="id">k2</span>)<br/>
| <span class="id">equiv_Tau</span> : <span class="kwd">forall</span> <span class="id">k1</span> <span class="id">k2</span>, <span class="id">equiv</span> <span class="id">k1</span> <span class="id">k2</span> -&gt; <span class="id">equiv</span> (<span class="id">Tau</span> <span class="id">k1</span>) (<span class="id">Tau</span> <span class="id">k2</span>)<br/>
| <span class="id">equiv_Err</span> : <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id">equiv</span> (<span class="id">Err</span> <span class="id">s1</span>) (<span class="id">Err</span> <span class="id">s2</span>)<br/>
.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
<span class="kwd">Module</span> <span class="id">MonadVerif</span>.<br/>
<br/>
<div class="doc">Get rid of absurd cases such as
    - forall t, Tau t &lt;&gt; Tau s
    - Tau t = Vis e k
 </div>
<span class="kwd">Ltac</span> <span class="id">dispatch_contra</span> :=<br/>
&nbsp;&nbsp;<span class="id">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="kwd">let</span> <span class="id">dispatch</span> <span class="id">H</span> <span class="id">tac</span> := <span class="id">solve</span> [<span class="id">exfalso</span>; <span class="tactic">eapply</span> <span class="id">H</span>; <span class="id">tac</span>] <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="kwd">forall</span> <span class="id">t</span>, ?<span class="id">f</span> <span class="id">t</span> &lt;&gt; ?<span class="id">f</span> ?<span class="id">s</span> |- <span class="id">_</span> =&gt; <span class="id">dispatch</span> <span class="id">H</span> <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">H</span> : <span class="kwd">forall</span> <span class="id">t</span>, ?<span class="id">f</span> <span class="id">t</span> &lt;&gt; ?<span class="id">s</span>, <span class="id">_</span> : ?<span class="id">f</span> ?<span class="id">u</span> = ?<span class="id">s</span> |- <span class="id">_</span> =&gt; <span class="id">dispatch</span> <span class="id">H</span> <span class="tactic">eauto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="tactic">discriminate</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;].<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">UnTau</span> <span class="id">E</span> <span class="id">X</span> : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span> -&gt; <span class="id">M</span> <span class="id">E</span> <span class="id">X</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">OneTau</span> : <span class="kwd">forall</span> <span class="id">s</span> <span class="id">t</span>, <span class="id">UnTau</span> <span class="id">s</span> <span class="id">t</span> -&gt; <span class="id">UnTau</span> (<span class="id">Tau</span> <span class="id">s</span>) <span class="id">t</span><br/>
| <span class="id">NoTau</span> : <span class="kwd">forall</span> <span class="id">s</span>, (<span class="kwd">forall</span> <span class="id">t</span>, ~(<span class="id">Tau</span> <span class="id">t</span> = <span class="id">s</span>)) -&gt; <span class="id">UnTau</span> <span class="id">s</span> <span class="id">s</span>.<br/>
<br/>
<span class="kwd">CoInductive</span> <span class="id">EquivUpToTau</span> <span class="id">E</span> <span class="id">X</span> :<br/>
&nbsp;&nbsp;<span class="id">M</span> <span class="id">E</span> <span class="id">X</span> -&gt; <span class="id">M</span> <span class="id">E</span> <span class="id">X</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">EquivRet</span> : <span class="kwd">forall</span> <span class="id">x</span>, <span class="id">EquivUpToTau</span> (<span class="id">Ret</span> <span class="id">x</span>) (<span class="id">Ret</span> <span class="id">x</span>)<br/>
| <span class="id">EquivVis</span> : <span class="kwd">forall</span> <span class="id">Y</span> (<span class="id">e</span> : <span class="id">E</span> <span class="id">Y</span>) (<span class="id">k1</span> <span class="id">k2</span> : <span class="id">Y</span> -&gt; <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">y</span>, <span class="id">EquivUpToTau</span> (<span class="id">k1</span> <span class="id">y</span>) (<span class="id">k2</span> <span class="id">y</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EquivUpToTau</span> (<span class="id">Vis</span> <span class="id">e</span> <span class="id">k1</span>) (<span class="id">Vis</span> <span class="id">e</span> <span class="id">k2</span>)<br/>
| <span class="id">EquivTau</span> : <span class="kwd">forall</span> <span class="id">s</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EquivUpToTau</span> <span class="id">s</span> <span class="id">t</span> -&gt; <span class="id">EquivUpToTau</span> (<span class="id">Tau</span> <span class="id">s</span>) (<span class="id">Tau</span> <span class="id">t</span>)<br/>
| <span class="id">EquivTauLeft</span> : <span class="kwd">forall</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">t</span>', ~(<span class="id">Tau</span> <span class="id">t</span>' = <span class="id">t</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">UnTau</span> <span class="id">s</span> <span class="id">s</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EquivUpToTau</span> <span class="id">s</span>' <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EquivUpToTau</span> (<span class="id">Tau</span> <span class="id">s</span>) <span class="id">t</span><br/>
| <span class="id">EquivTauRight</span> : <span class="kwd">forall</span> <span class="id">s</span> <span class="id">t</span> <span class="id">t</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">s</span>', ~(<span class="id">Tau</span> <span class="id">s</span>' = <span class="id">s</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">UnTau</span> <span class="id">t</span> <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EquivUpToTau</span> <span class="id">s</span> <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EquivUpToTau</span> <span class="id">s</span> (<span class="id">Tau</span> <span class="id">t</span>)<br/>
| <span class="id">EquivErr</span> : <span class="kwd">forall</span> <span class="id">s1</span> <span class="id">s2</span>, <span class="id">EquivUpToTau</span> (<span class="id">Err</span> <span class="id">s1</span>) (<span class="id">Err</span> <span class="id">s2</span>)<br/>
.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">eutt_refl</span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">X</span> (<span class="id">s</span> : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EquivUpToTau</span> <span class="id">s</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof149')">Proof.</div>
<div class="proofscript" id="proof149">
&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">eutt_refl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">s</span>; <span class="id">constructor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">eutt_refl</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eutt_sym</span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">X</span> (<span class="id">s</span> <span class="id">t</span> : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EquivUpToTau</span> <span class="id">s</span> <span class="id">t</span> -&gt; <span class="id">EquivUpToTau</span> <span class="id">t</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof150')">Proof.</div>
<div class="proofscript" id="proof150">
&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">eutt_sym</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>; <span class="tactic">try</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intro</span> <span class="id">y</span>. <span class="tactic">apply</span> <span class="id">eutt_sym</span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">apply</span> <span class="id">eutt_sym</span>. <span class="tactic">apply</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="id">econstructor</span>. <span class="tactic">assumption</span>. <span class="id">eassumption</span>. <span class="tactic">apply</span> <span class="id">eutt_sym</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">econstructor</span>. <span class="tactic">assumption</span>. <span class="id">eassumption</span>. <span class="tactic">apply</span> <span class="id">eutt_sym</span>. <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">untau_notau</span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">X</span> (<span class="id">s</span> <span class="id">t</span> : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>), ~(<span class="id">UnTau</span> <span class="id">s</span> (<span class="id">Tau</span> <span class="id">t</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof151')">Proof.</div>
<div class="proofscript" id="proof151">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">E</span> <span class="id">X</span> <span class="id">s</span> <span class="id">t</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="id">remember</span> (<span class="id">Tau</span> <span class="id">t</span>) <span class="kwd">as</span> <span class="id">t</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">eapply</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">untau_untau</span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">X</span> (<span class="id">s</span> <span class="id">t</span> : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">UnTau</span> <span class="id">s</span> <span class="id">t</span> -&gt; <span class="id">UnTau</span> <span class="id">t</span> <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof152')">Proof.</div>
<div class="proofscript" id="proof152">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">E</span> <span class="id">X</span> <span class="id">s</span> <span class="id">t</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>; <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">untau_inj</span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">X</span> (<span class="id">s</span> <span class="id">s</span>' <span class="id">s</span>'' : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">UnTau</span> <span class="id">s</span> <span class="id">s</span>' -&gt; <span class="id">UnTau</span> <span class="id">s</span> <span class="id">s</span>'' -&gt; <span class="id">s</span>' = <span class="id">s</span>''.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof153')">Proof.</div>
<div class="proofscript" id="proof153">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">E</span> <span class="id">X</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">s</span>'' <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>; <span class="tactic">intro</span> <span class="id">H</span>'; <span class="tactic">inversion</span> <span class="id">H</span>'.<br/>
&nbsp;&nbsp;- <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="id">dispatch_contra</span>.<br/>
&nbsp;&nbsp;- <span class="id">dispatch_contra</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eutt_untau</span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">X</span> (<span class="id">s</span> <span class="id">s</span>' <span class="id">t</span> : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">UnTau</span> <span class="id">s</span> <span class="id">s</span>' -&gt; <span class="id">EquivUpToTau</span> <span class="id">s</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">t</span>', <span class="id">UnTau</span> <span class="id">t</span> <span class="id">t</span>' /\ <span class="id">EquivUpToTau</span> <span class="id">s</span>' <span class="id">t</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof154')">Proof.</div>
<div class="proofscript" id="proof154">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">E</span> <span class="id">X</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">t</span> <span class="id">HUnTau</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">HUnTau</span> <span class="kwd">as</span> [ <span class="id">s</span> <span class="id">s</span>' <span class="id">HUnTau</span> <span class="id">IH</span> | <span class="id">s</span> <span class="id">HNoTau</span> ]; <span class="tactic">intros</span> <span class="id">t</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span> <span class="kwd">as</span> [ | | <span class="id">s1</span> <span class="id">t1</span> <span class="id">H1</span> | <span class="id">s1</span> <span class="id">s1</span>' ? <span class="id">HtNoTau</span> | | ].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IH</span> <span class="kwd">in</span> <span class="id">H1</span>; <span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [<span class="id">t</span>' <span class="id">H1</span>]; <span class="tactic">destruct</span> <span class="id">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eexists</span>; <span class="tactic">split</span>. <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">replace</span> <span class="id">s</span>' <span class="kwd">with</span> <span class="id">s1</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">eapply</span> <span class="id">untau_inj</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">dispatch_contra</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eexists</span>; <span class="tactic">split</span>; <span class="id">constructor</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eexists</span>; <span class="tactic">split</span>; <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">t</span> <span class="id">I</span>. <span class="tactic">inversion</span> <span class="id">I</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">dispatch_contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">dispatch_contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eexists</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eexists</span>; <span class="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>. <span class="tactic">intros</span>. <span class="tactic">unfold</span> <span class="id">not</span>. <span class="tactic">intros</span>. <span class="tactic">inversion</span> <span class="id">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eutt_tau_2</span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">X</span> (<span class="id">s</span> <span class="id">s</span>' <span class="id">t</span> <span class="id">t</span>' : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">UnTau</span> <span class="id">s</span> <span class="id">s</span>' -&gt; <span class="id">UnTau</span> <span class="id">t</span> <span class="id">t</span>' -&gt; <span class="id">EquivUpToTau</span> <span class="id">s</span>' <span class="id">t</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EquivUpToTau</span> <span class="id">s</span> <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof155')">Proof.</div>
<div class="proofscript" id="proof155">
&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">eutt_tau_2</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">E</span> <span class="id">X</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">t</span> <span class="id">t</span>' <span class="id">Hs</span> <span class="id">Ht</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Hs</span>, <span class="id">Ht</span>.<br/>
&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">eutt_tau_2</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">econstructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="id">econstructor</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="id">constructor</span>; <span class="tactic">assumption</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dispatch_contra</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eutt_untau_2</span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">X</span> (<span class="id">s</span> <span class="id">s</span>' <span class="id">t</span> <span class="id">t</span>' : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">UnTau</span> <span class="id">s</span> <span class="id">s</span>' -&gt; <span class="id">UnTau</span> <span class="id">t</span> <span class="id">t</span>' -&gt; <span class="id">EquivUpToTau</span> <span class="id">s</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EquivUpToTau</span> <span class="id">s</span>' <span class="id">t</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof156')">Proof.</div>
<div class="proofscript" id="proof156">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">E</span> <span class="id">X</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">t</span> <span class="id">t</span>' <span class="id">Hs</span>.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">t</span>'.<br/>
&nbsp;&nbsp;<span class="tactic">generalize</span> <span class="tactic">dependent</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hs</span> <span class="kwd">as</span> [ <span class="id">s</span> <span class="id">s</span>' | <span class="id">s</span> <span class="id">He</span> ].<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">t</span> <span class="id">t</span>' <span class="id">Ht</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="tactic">inversion</span> <span class="id">Ht</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">dispatch_contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">IHHs</span>. <span class="id">eassumption</span>. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">replace</span> <span class="id">s</span>'0 <span class="kwd">with</span> <span class="id">s</span>' <span class="kwd">in</span> *. <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">untau_inj</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">t</span> <span class="id">t</span>' <span class="id">Ht</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Ht</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">dispatch_contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>; <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">replace</span> <span class="id">t</span>'0 <span class="kwd">with</span> <span class="id">t</span>' <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">untau_inj</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eutt_untau_trans</span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">X</span> (<span class="id">s</span> <span class="id">s</span>' <span class="id">t</span> : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">UnTau</span> <span class="id">s</span> <span class="id">s</span>' -&gt; <span class="id">EquivUpToTau</span> <span class="id">s</span>' <span class="id">t</span> -&gt; <span class="id">EquivUpToTau</span> <span class="id">s</span> <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof157')">Proof.</div>
<div class="proofscript" id="proof157">
&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">eutt_untau_trans</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">E</span> <span class="id">X</span> <span class="id">s</span> <span class="id">s</span>' <span class="id">t</span> <span class="id">H</span> <span class="id">I</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;{ <span class="tactic">inversion</span> <span class="id">I</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">t</span>' <span class="id">J</span>; <span class="tactic">inversion</span> <span class="id">J</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">t</span>' <span class="id">J</span>; <span class="tactic">inversion</span> <span class="id">J</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> (<span class="id">untau_notau</span> <span class="id">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">eutt_untau_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">eutt_tau_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">untau_untau</span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">t</span>' <span class="id">J</span>; <span class="tactic">inversion</span> <span class="id">J</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Import</span> <span class="id">Logic.ProofIrrelevance</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">vis_inj</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">E</span> <span class="id">X</span> <span class="id">Y</span> (<span class="id">e</span> <span class="id">e</span>' : <span class="id">E</span> <span class="id">Y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">k</span> : <span class="id">Y</span> -&gt; <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>) (<span class="id">k</span>' : <span class="id">Y</span> -&gt; <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Vis</span> <span class="id">e</span> <span class="id">k</span> = <span class="id">Vis</span> <span class="id">e</span>' <span class="id">k</span>' -&gt; <span class="id">e</span> = <span class="id">e</span>'.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof158')">Proof.</div>
<div class="proofscript" id="proof158">
Admitted.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eutt_err_t</span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">X</span> <span class="id">s1</span> <span class="id">s2</span> (<span class="id">t</span> : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>) , <span class="id">EquivUpToTau</span> (<span class="id">Err</span> <span class="id">s1</span>) <span class="id">t</span> -&gt; <span class="id">EquivUpToTau</span> (<span class="id">Err</span> <span class="id">s2</span>) <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof159')">Proof.</div>
<div class="proofscript" id="proof159">
&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">eutt_err_t</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">E</span> <span class="id">X</span> <span class="id">s1</span> <span class="id">s2</span> <span class="id">t</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>; <span class="tactic">auto</span>. <span class="tactic">apply</span> <span class="id">H1</span>. <span class="tactic">eapply</span> <span class="id">eutt_err_t</span>. <span class="tactic">apply</span> <span class="id">H2</span>.<br/>
&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">eutt_trans</span> : <span class="kwd">forall</span> <span class="id">E</span> <span class="id">X</span> (<span class="id">s</span> <span class="id">t</span> <span class="id">u</span> : <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EquivUpToTau</span> <span class="id">s</span> <span class="id">t</span> -&gt; <span class="id">EquivUpToTau</span> <span class="id">t</span> <span class="id">u</span> -&gt; <span class="id">EquivUpToTau</span> <span class="id">s</span> <span class="id">u</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof160')">Proof.</div>
<div class="proofscript" id="proof160">
&nbsp;&nbsp;<span class="id">cofix</span> <span class="id">eutt_trans</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">E</span> <span class="id">X</span> <span class="id">s</span> <span class="id">t</span> <span class="id">u</span> <span class="id">H1</span> <span class="id">H2</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H1</span> <span class="kwd">as</span> [ | ? <span class="id">e1</span> <span class="id">ks</span> <span class="id">kt</span> | | | | ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H2</span> <span class="kwd">as</span> [ | ? <span class="id">e2</span> <span class="id">kt</span>' <span class="id">ku</span> | | <span class="id">t2</span> <span class="id">t2</span>' <span class="id">u2</span> | | ].<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Ret,&nbsp;Ret,&nbsp;Ret&nbsp;*)</span> <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Ret,&nbsp;Ret,&nbsp;Tau&nbsp;*)</span> <span class="id">econstructor</span>; <span class="tactic">try</span> <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Vis,&nbsp;Vis,&nbsp;Vis&nbsp;*)</span><br/>
&nbsp;induction&nbsp;Hk&nbsp;as&nbsp;[?&nbsp;Hk]&nbsp;using&nbsp;eq_sigT_rect.&nbsp;*)</span> <span class="tactic">replace</span> <span class="id">e2</span> <span class="kwd">with</span> <span class="id">e1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">eutt_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">replace</span> <span class="id">kt</span> <span class="kwd">with</span> <span class="id">kt</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="tactic">apply</span> <span class="id">inj_pair2</span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="kwd">fun</span> <span class="id">Y</span> =&gt; <span class="id">Y</span> -&gt; <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">symmetry</span>. <span class="tactic">apply</span> <span class="id">inj_pair2</span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id">E</span>). <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Vis,&nbsp;Vis,&nbsp;Tau&nbsp;*)</span> <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> ? <span class="id">I</span>. <span class="tactic">inversion</span> <span class="id">I</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">eutt_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Tau,&nbsp;Tau,&nbsp;Tau&nbsp;*)</span> <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">eutt_trans</span>; <span class="tactic">try</span> <span class="id">eassumption</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Tau,&nbsp;Tau,&nbsp;~Tau&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">I</span> : <span class="id">exists</span> <span class="id">s</span>', <span class="id">UnTau</span> <span class="id">s</span> <span class="id">s</span>' /\ <span class="id">EquivUpToTau</span> <span class="id">t2</span>' <span class="id">s</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">apply</span> <span class="id">eutt_untau</span> <span class="kwd">with</span> (<span class="id">s</span> := <span class="id">t</span>) (<span class="id">s</span>' := <span class="id">t2</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">eutt_sym</span>. <span class="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">I</span> <span class="kwd">as</span> [<span class="id">s</span>' [<span class="id">I1</span> <span class="id">I2</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">eutt_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">eutt_sym</span>; <span class="tactic">apply</span> <span class="id">I2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Tau,&nbsp;Tau&nbsp;&amp;&nbsp;~Tau,&nbsp;Tau&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dispatch_contra</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Tau,&nbsp;Ret,&nbsp;Ret&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id">EquivTauLeft</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">t</span>' <span class="id">I</span>; <span class="tactic">inversion</span> <span class="id">I</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Tau,&nbsp;Vis,&nbsp;Vis&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id">EquivTauLeft</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">intros</span> <span class="id">t</span>' <span class="id">I</span>; <span class="tactic">inversion</span> <span class="id">I</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">eutt_trans</span>; <span class="id">eassumption</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Tau,&nbsp;~Tau&nbsp;&amp;&nbsp;Tau,&nbsp;Tau&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dispatch_contra</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Tau,&nbsp;~Tau&nbsp;&amp;&nbsp;Tau,&nbsp;~Tau&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dispatch_contra</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;Tau,&nbsp;~Tau,&nbsp;Tau&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">eutt_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">eutt_untau_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">eutt_sym</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">eutt_untau_trans</span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">eutt_sym</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id">EquivTauLeft</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">t</span>' <span class="id">I</span>; <span class="tactic">inversion</span> <span class="id">I</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">eutt_trans</span>. <span class="tactic">apply</span> <span class="id">H1</span>. <span class="tactic">apply</span> <span class="id">H2</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;~Tau,&nbsp;Tau,&nbsp;Tau&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">I</span> : <span class="id">exists</span> <span class="id">u</span>', <span class="id">UnTau</span> <span class="id">u</span> <span class="id">u</span>' /\ <span class="id">EquivUpToTau</span> <span class="id">t</span>' <span class="id">u</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">eutt_untau</span>. <span class="tactic">apply</span> <span class="id">OneTau</span>. <span class="id">eassumption</span>. <span class="id">eassumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">I</span> <span class="kwd">as</span> [<span class="id">u</span>' [<span class="id">I</span> ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">I</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">inversion</span> <span class="id">H5</span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">eapply</span> <span class="id">eutt_trans</span>; <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">dispatch_contra</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;~Tau,&nbsp;Tau,&nbsp;~Tau&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">I</span> : <span class="id">t</span>' = <span class="id">t2</span>').<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="tactic">eapply</span> <span class="id">untau_inj</span>; <span class="id">eassumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">I</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H5</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">assumption</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">dispatch_contra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">inversion</span> <span class="id">H12</span>. <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">e0</span> <span class="kwd">with</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">k0</span> <span class="kwd">with</span> <span class="id">k2</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intro</span> <span class="id">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">eutt_trans</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">inj_pair2</span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="kwd">fun</span> <span class="id">Y</span> =&gt; <span class="id">Y</span> -&gt; <span class="id">M</span> <span class="id">E</span> <span class="id">X</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">apply</span> <span class="id">inj_pair2</span> <span class="kwd">with</span> (<span class="id">P</span> := <span class="id">E</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exfalso</span>. <span class="tactic">eapply</span> <span class="id">untau_notau</span>. <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">constructor</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;~Tau,&nbsp;Tau&nbsp;&amp;&nbsp;~Tau,&nbsp;Tau&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">dispatch_contra</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">subst</span>. <span class="id">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">u</span> <span class="id">I</span>; <span class="tactic">inversion</span> <span class="id">I</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">eassumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">eapply</span> <span class="id">eutt_err_t</span>. <span class="tactic">apply</span> <span class="id">H1</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="id">econstructor</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Instance</span> <span class="id">equiv_eutt</span> {<span class="id">E</span>} <span class="id">X</span> : <span class="id">Equiv</span> (<span class="id">M</span> <span class="id">E</span> <span class="id">X</span>) := (@<span class="id">EquivUpToTau</span> <span class="id">E</span> <span class="id">X</span>).<br/>
<br/>
<span class="kwd">Instance</span> <span class="id">M_functor_eutt_laws</span> {<span class="id">E</span>} : (@<span class="id">FunctorLaws</span> (<span class="id">M</span> <span class="id">E</span>)) (@<span class="id">mapM</span> <span class="id">E</span>) (@<span class="id">equiv_eutt</span> <span class="id">E</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof161')">Proof.</div>
<div class="proofscript" id="proof161">
Admitted.</div>
<br/>
<span class="kwd">Program</span> <span class="kwd">Instance</span> <span class="id">M_monad_eutt_laws</span> {<span class="id">E</span>} : (@<span class="id">MonadLaws</span> (<span class="id">M</span> <span class="id">E</span>)) (@<span class="id">functor_M</span> <span class="id">E</span>) (@<span class="id">monad_M</span> <span class="id">E</span>) <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof162')">Next Obligation.</div>
<div class="proofscript" id="proof162">
&nbsp;&nbsp;Admitted.</div>
<div class="toggleproof" onclick="toggleDisplay('proof163')">Next Obligation.</div>
<div class="proofscript" id="proof163">
&nbsp;&nbsp;Admitted.</div>
<div class="toggleproof" onclick="toggleDisplay('proof164')">Next Obligation.</div>
<div class="proofscript" id="proof164">
&nbsp;&nbsp;Admitted.</div>
<br/>
<br/>
<span class="kwd">End</span> <span class="id">MonadVerif</span>.<br/>
<br/>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
