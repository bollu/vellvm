<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module Misc</title>
<meta name="description" content="Documentation of Coq module Misc" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module Misc</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Basics</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.Util</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">opt_compose</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span>} (<span class="id">g</span>:<span class="id">B</span> -&gt; <span class="id">C</span>) (<span class="id">f</span>:<span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">B</span>) : <span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">C</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">option_map</span> <span class="id">g</span> (<span class="id">f</span> <span class="id">a</span>).<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">option_iter</span> {<span class="id">A</span>} (<span class="id">f</span>:<span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">A</span>) (<span class="id">a</span>:<span class="id">A</span>) (<span class="id">n</span>:<span class="id">nat</span>) : <span class="id">option</span> <span class="id">A</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">n</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| 0 =&gt; <span class="id">Some</span> <span class="id">a</span><br/>
&nbsp;&nbsp;| <span class="id">S</span> <span class="id">n</span>' =&gt; <span class="kwd">match</span> <span class="id">f</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">a</span>' =&gt; <span class="id">option_iter</span> <span class="id">f</span> <span class="id">a</span>' <span class="id">n</span>'<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="id">Arguments</span> <span class="id">option_map</span> {<span class="id">_</span> <span class="id">_</span>} <span class="id">_</span> <span class="id">_</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">option_map_id</span> : <span class="kwd">forall</span> <span class="id">A</span> (<span class="id">a</span> : <span class="id">option</span> <span class="id">A</span>), <span class="id">option_map</span> <span class="id">id</span> <span class="id">a</span> = <span class="id">a</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof150')">Proof.</div>
<div class="proofscript" id="proof150">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">option_map</span>; <span class="tactic">destruct</span> <span class="id">a</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">option_map_ext</span> : <span class="kwd">forall</span> <span class="id">A</span> <span class="id">B</span> (<span class="id">f</span> <span class="id">g</span>:<span class="id">A</span>-&gt;<span class="id">B</span>),<br/>
&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id">f</span> <span class="id">a</span> = <span class="id">g</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">oa</span>, <span class="id">option_map</span> <span class="id">f</span> <span class="id">oa</span> = <span class="id">option_map</span> <span class="id">g</span> <span class="id">oa</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof151')">Proof.</div>
<div class="proofscript" id="proof151">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">oa</span>. <span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H</span>; <span class="tactic">auto</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">option_map_some_inv</span> {<span class="id">A</span> <span class="id">B</span>} : <span class="kwd">forall</span> (<span class="id">o</span>:<span class="id">option</span> <span class="id">A</span>) (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">B</span>) (<span class="id">b</span>:<span class="id">B</span>),<br/>
&nbsp;&nbsp;<span class="id">option_map</span> <span class="id">f</span> <span class="id">o</span> = <span class="id">Some</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">a</span>, <span class="id">o</span> = <span class="id">Some</span> <span class="id">a</span> /\ <span class="id">f</span> <span class="id">a</span> = <span class="id">b</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof152')">Proof.</div>
<div class="proofscript" id="proof152">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">simpl</span>; <span class="tactic">intros</span>; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">option_prop</span> {<span class="id">A</span>} (<span class="id">P</span>: <span class="id">A</span> -&gt; <span class="kwd">Prop</span>) (<span class="id">a</span>:<span class="id">option</span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">a</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">a</span>' =&gt; <span class="id">P</span> <span class="id">a</span>'<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">option_bind</span> {<span class="id">A</span> <span class="id">B</span>} (<span class="id">m</span>:<span class="id">option</span> <span class="id">A</span>) (<span class="id">f</span>:<span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">B</span>) : <span class="id">option</span> <span class="id">B</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Some</span> <span class="id">a</span> =&gt; <span class="id">f</span> <span class="id">a</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">option_bind2</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span>} (<span class="id">m</span>: <span class="id">option</span> (<span class="id">A</span> * <span class="id">B</span>)) (<span class="id">f</span>: <span class="id">A</span> -&gt; <span class="id">B</span> -&gt; <span class="id">option</span> <span class="id">C</span>) : <span class="id">option</span> <span class="id">C</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">m</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">a</span>, <span class="id">b</span>) =&gt; <span class="id">f</span> <span class="id">a</span> <span class="id">b</span><br/>
&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">None</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Module</span> <span class="id">OptionNotations</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Notation</span> "'<span class="tactic">do</span>' <span class="id">x</span> &lt;- <span class="id">m</span> ; <span class="id">f</span>" := (<span class="id">option_bind</span> <span class="id">m</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">f</span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">at</span> <span class="id">level</span> 200, <span class="id">x</span> <span class="id">ident</span>, <span class="id">m</span> <span class="tactic">at</span> <span class="id">level</span> 100, <span class="id">f</span> <span class="tactic">at</span> <span class="id">level</span> 200).<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">Notation</span> "'<span class="tactic">do</span>' <span class="id">x</span> , <span class="id">y</span> &lt;- <span class="id">m</span> ; <span class="id">f</span>" := (<span class="id">option_bind2</span> <span class="id">m</span> (<span class="kwd">fun</span> <span class="id">x</span> <span class="id">y</span> =&gt; <span class="id">f</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="tactic">at</span> <span class="id">level</span> 200, <span class="id">x</span> <span class="id">ident</span>, <span class="id">y</span> <span class="id">ident</span>, <span class="id">m</span> <span class="tactic">at</span> <span class="id">level</span> 100, <span class="id">f</span> <span class="tactic">at</span> <span class="id">level</span> 200).<br/>
<br/>
<span class="kwd">End</span> <span class="id">OptionNotations</span>.<br/>
<br/>
<span class="kwd">Tactic</span> <span class="kwd">Notation</span> "<span class="id">not_var</span>" <span class="id">constr</span>(<span class="id">t</span>) :=<br/>
&nbsp;&nbsp;<span class="tactic">try</span> (<span class="id">is_var</span> <span class="id">t</span>; <span class="tactic">fail</span> 1 "<span class="id">not_var</span>").<br/>
<br/>
<span class="id">Create</span> <span class="id">HintDb</span> <span class="id">inversions</span>.<br/>
<span class="kwd">Tactic</span> <span class="kwd">Notation</span> "<span class="id">iauto</span>" := <span class="tactic">auto</span> 10 <span class="kwd">with</span> <span class="id">inversions</span>.<br/>
<span class="kwd">Tactic</span> <span class="kwd">Notation</span> "<span class="id">ieauto</span>" := <span class="tactic">eauto</span> 10 <span class="kwd">with</span> <span class="id">inversions</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">map_prod</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">D</span>} (<span class="id">p</span>:<span class="id">A</span> * <span class="id">B</span>) (<span class="id">f</span>:<span class="id">A</span> -&gt; <span class="id">C</span>) (<span class="id">g</span>:<span class="id">B</span> -&gt; <span class="id">D</span>) : (<span class="id">C</span> * <span class="id">D</span>) :=<br/>
&nbsp;&nbsp;(<span class="id">f</span> (<span class="id">fst</span> <span class="id">p</span>), <span class="id">g</span> (<span class="id">snd</span> <span class="id">p</span>)).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">flip</span> := @<span class="id">Basics.flip</span>.<br/>
<span class="kwd">Definition</span> <span class="id">comp</span> := @<span class="id">Basics.compose</span>.<br/>
<br/>
<span class="kwd">Notation</span> "<span class="id">g</span> `<span class="id">o</span>` <span class="id">f</span>" := (<span class="id">Basics.compose</span> <span class="id">g</span> <span class="id">f</span>) <br/>
&nbsp;&nbsp;(<span class="tactic">at</span> <span class="id">level</span> 40, <span class="id">left</span> <span class="id">associativity</span>).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">map_prod_distr_comp</span> : <span class="kwd">forall</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">D</span> <span class="id">E</span> <span class="id">F</span><br/>
&nbsp;&nbsp;(<span class="id">p</span>:<span class="id">A</span> * <span class="id">B</span>) (<span class="id">f1</span>:<span class="id">A</span> -&gt; <span class="id">C</span>) (<span class="id">f2</span>:<span class="id">B</span> -&gt; <span class="id">D</span>) (<span class="id">g1</span>:<span class="id">C</span> -&gt; <span class="id">E</span>) (<span class="id">g2</span>:<span class="id">D</span> -&gt; <span class="id">F</span>),<br/>
&nbsp;&nbsp;<span class="id">map_prod</span> (<span class="id">map_prod</span> <span class="id">p</span> <span class="id">f1</span> <span class="id">f2</span>) <span class="id">g1</span> <span class="id">g2</span> =<br/>
&nbsp;&nbsp;<span class="id">map_prod</span> <span class="id">p</span> (<span class="id">g1</span> `<span class="id">o</span>` <span class="id">f1</span>) (<span class="id">g2</span> `<span class="id">o</span>` <span class="id">f2</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof153')">Proof.</div>
<div class="proofscript" id="proof153">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">map_prod</span>, <span class="id">Basics.compose</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">map_snd</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span>} (<span class="id">f</span>:<span class="id">B</span> -&gt; <span class="id">C</span>) : <span class="id">list</span> (<span class="id">A</span> * <span class="id">B</span>) -&gt; <span class="id">list</span> (<span class="id">A</span> * <span class="id">C</span>) :=<br/>
&nbsp;&nbsp;<span class="id">map</span> (<span class="kwd">fun</span> <span class="id">ab</span> : <span class="id">A</span> * <span class="id">B</span> =&gt; <span class="kwd">let</span> (<span class="id">a</span>, <span class="id">b</span>) := <span class="id">ab</span> <span class="kwd">in</span> (<span class="id">a</span>, <span class="id">f</span> <span class="id">b</span>)).<br/>
<br/>
<span class="kwd">Import</span> <span class="id">OptionNotations</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">option_bind_assoc</span> {<span class="id">A</span> <span class="id">B</span> <span class="id">C</span>} : <span class="kwd">forall</span> (<span class="id">o</span>:<span class="id">option</span> <span class="id">A</span>) (<span class="id">p</span>:<span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">B</span>) (<span class="id">q</span>:<span class="id">B</span> -&gt; <span class="id">option</span> <span class="id">C</span>),<br/>
&nbsp;&nbsp;&nbsp;(<span class="tactic">do</span> <span class="id">y</span> &lt;- (<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">o</span>; <span class="id">p</span> <span class="id">x</span>); <span class="id">q</span> <span class="id">y</span>) = (<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">o</span>; <span class="tactic">do</span> <span class="id">y</span> &lt;- <span class="id">p</span> <span class="id">x</span>; <span class="id">q</span> <span class="id">y</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof154')">Proof.</div>
<div class="proofscript" id="proof154">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">o</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">option_bind_some_inv</span> {<span class="id">A</span> <span class="id">B</span>} : <span class="kwd">forall</span> (<span class="id">o</span>:<span class="id">option</span> <span class="id">A</span>) (<span class="id">p</span>:<span class="id">A</span> -&gt; <span class="id">option</span> <span class="id">B</span>) (<span class="id">b</span>:<span class="id">B</span>),<br/>
&nbsp;&nbsp;(<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">o</span>; <span class="id">p</span> <span class="id">x</span>) = <span class="id">Some</span> <span class="id">b</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id">exists</span> <span class="id">a</span>, <span class="id">o</span> = <span class="id">Some</span> <span class="id">a</span> /\ <span class="id">p</span> <span class="id">a</span> = <span class="id">Some</span> <span class="id">b</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof155')">Proof.</div>
<div class="proofscript" id="proof155">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">destruct</span> <span class="id">o</span>. <span class="id">eexists</span>. <span class="tactic">eauto</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">option_bind_None</span> : <span class="kwd">forall</span> <span class="id">A</span> <span class="id">B</span> (<span class="id">m</span> : <span class="id">option</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;(<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">m</span>; (<span class="id">None</span>(<span class="id">A</span> := <span class="id">B</span>))) = <span class="id">None</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof156')">Proof.</div>
<div class="proofscript" id="proof156">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">option_bind_some</span> : <span class="kwd">forall</span> <span class="id">A</span> (<span class="id">m</span> : <span class="id">option</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;(<span class="tactic">do</span> <span class="id">x</span> &lt;- <span class="id">m</span>; <span class="id">Some</span> <span class="id">x</span>) = <span class="id">m</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof157')">Proof.</div>
<div class="proofscript" id="proof157">
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Tactic</span> <span class="kwd">Notation</span> "<span class="id">inv_bind</span>" <span class="id">hyp</span>(<span class="id">H</span>) :=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="tactic">rewrite</span> <span class="id">option_bind_assoc</span> <span class="kwd">in</span> <span class="id">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">type</span> <span class="id">of</span> <span class="id">H</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">option_bind</span> ?<span class="id">o</span> ?<span class="id">p</span> = <span class="id">Some</span> ?<span class="id">b</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">hy</span> := <span class="tactic">fresh</span> <span class="id">H</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">o</span> <span class="id">eqn</span>:<span class="id">hy</span>; [|<span class="tactic">discriminate</span>]; <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">map_option_map</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> (<span class="id">f</span> : <span class="id">B</span> -&gt; <span class="id">option</span> <span class="id">C</span>) (<span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id">B</span>) (<span class="id">l</span> : <span class="id">list</span> <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">map_option</span> <span class="id">f</span> (<span class="id">map</span> <span class="id">g</span> <span class="id">l</span>) = <span class="id">map_option</span> (<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">f</span> (<span class="id">g</span> <span class="id">x</span>)) <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof158')">Proof.</div>
<div class="proofscript" id="proof158">
&nbsp;&nbsp;<span class="tactic">intros</span>. <span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">eauto</span>.<br/>
Qed.</div>
<br/>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
