<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module StoreSwitchProof</title>
<meta name="description" content="Documentation of Coq module StoreSwitchProof" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module StoreSwitchProof</h1>
<div class="coq">
<br/>
<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">ZArith</span> <span class="id">List</span> <span class="id">String</span> <span class="id">Omega</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.AstLib</span> <span class="id">Vellvm.LLVMAst</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.Classes</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.Util</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.CFG</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.LLVMIO</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.DynamicValues</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span>  <span class="id">Vellvm.Classes</span> <span class="id">Vellvm.Util</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.LLVMAst</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.TypeUtil</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.Memory</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.Trace</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Setoid</span> <span class="id">Morphisms</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coq.Setoids.Setoid</span>.<br/>
<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">SetoidClass</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coq.Classes.RelationClasses</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coq.Classes.Equivalence</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.StoreSwitch</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.TopLevel</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.Memory</span>.<br/>
<span class="kwd">Require</span> <span class="id">FunctionalExtensionality</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Eqdep_dec</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Classical</span>.<br/>
<span class="kwd">Import</span> <span class="id">Trace.MonadVerif</span>.<br/>
<br/>
<br/>
<span class="id">From</span> <span class="id">mathcomp</span> <span class="kwd">Require</span> <span class="id">ssreflect</span> <span class="id">ssrbool</span> <span class="id">ssrfun</span> <span class="id">bigop</span>.<br/>
<span class="kwd">Import</span> <span class="id">ssreflect.SsrSyntax</span>.<br/>
<span class="kwd">Set</span> <span class="kwd">Implicit</span> <span class="id">Arguments</span>.<br/>
<span class="kwd">Unset</span> <span class="kwd">Strict</span> <span class="kwd">Implicit</span>.<br/>
<span class="kwd">Unset</span> <span class="id">Printing</span> <span class="kwd">Implicit</span> <span class="id">Defensive</span>.<br/>
<br/>
<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">Z_scope</span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">string_scope</span>.<br/>
<br/>
<span class="id">Locate</span> "==".<br/>
<br/>
<span class="kwd">Import</span> <span class="id">SS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
<span class="kwd">Import</span> <span class="id">FunctionalExtensionality</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">bindM_Raise</span>: <span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span>: <span class="kwd">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span>: <span class="id">string</span>) (<span class="id">f</span>: <span class="id">A</span> -&gt; <span class="id">IO.Trace</span> <span class="id">B</span>), <span class="id">bindM</span> (<span class="id">raise</span> <span class="id">s</span>) <span class="id">f</span> ≡ <span class="id">Err</span> <span class="id">s</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof296')">Proof.</div>
<div class="proofscript" id="proof296">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">raise</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">IO.exn_trace</span>.<br/>
&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">bindM_Raise</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> @<span class="id">bindM_Raise</span>:<span class="id">euttnormdb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
<span class="kwd">Lemma</span>  <span class="id">eval_type_I64</span>: <span class="kwd">forall</span> (<span class="id">cfg</span>: <span class="id">mcfg</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval_typ</span> <span class="id">cfg</span> (<span class="id">TYPE_I</span> 64) = <span class="id">DTYPE_I</span> 64.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof297')">Proof.</div>
<div class="proofscript" id="proof297">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">eval_typ</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">eval_type_I64</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span>  <span class="id">eval_type_I32</span>: <span class="kwd">forall</span> (<span class="id">cfg</span>: <span class="id">mcfg</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval_typ</span> <span class="id">cfg</span> (<span class="id">TYPE_I</span> 32) = <span class="id">DTYPE_I</span> 32.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof298')">Proof.</div>
<div class="proofscript" id="proof298">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">eval_typ</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">eval_type_I32</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">eval_type_array_i32</span>: <span class="kwd">forall</span> (<span class="id">CFG</span>: <span class="id">mcfg</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">SS.eval_typ</span> <span class="id">CFG</span> (<span class="id">TYPE_Array</span> 2 (<span class="id">TYPE_I</span> 32))) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">DTYPE_Array</span> 2 (<span class="id">DTYPE_I</span> 32).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof299')">Proof.</div>
<div class="proofscript" id="proof299">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">SS.eval_typ</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>; <span class="tactic">simpl</span>).<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">eval_type_array_i32</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">eval_typ_equals</span>: <span class="kwd">forall</span> (<span class="id">mcfg</span>: <span class="id">mcfg</span>) (<span class="id">t</span>: <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eval_typ</span> (<span class="id">rewrite_mcfg</span> <span class="id">mcfg</span>) <span class="id">t</span> = <span class="id">eval_typ</span> <span class="id">mcfg</span> <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof300')">Proof.</div>
<div class="proofscript" id="proof300">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">unfold</span> <span class="id">eval_typ</span>).<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">eval_typ_equals</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">eval_typ_equals</span>.<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">patternMkGEPAtIx</span> (<span class="id">ix</span>: <span class="id">Z</span>)  : <span class="id">texp</span> :=<br/>
&nbsp;&nbsp;((<span class="id">TYPE_Array</span> 2 <span class="id">i32TY</span>), <span class="id">OP_GetElementPtr</span> (<span class="id">TYPE_Array</span> 2 (<span class="id">TYPE_I</span> 32%<span class="id">Z</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TYPE_Pointer</span> (<span class="id">TYPE_Array</span> 2 (<span class="id">TYPE_I</span> 32%<span class="id">Z</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EXP_Ident</span> (<span class="id">ID_Local</span> (<span class="id">Name</span> "<span class="id">x</span>")))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[(<span class="id">i32TY</span>, <span class="id">EXP_Integer</span> <span class="id">ix</span>)]).<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">codeToMatch</span>  : <span class="id">code</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[(<span class="id">IId</span> (<span class="id">Name</span> "<span class="id">x</span>"), <span class="id">INSTR_Alloca</span> <span class="id">i32PTRTY</span> (<span class="id">Some</span> ((<span class="id">TYPE_I</span> (32%<span class="id">Z</span>)),  <span class="id">EXP_Integer</span> 0)) <span class="id">None</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IVoid</span> 0%<span class="id">Z</span>, <span class="id">INSTR_Store</span>  <span class="id">false</span> (<span class="id">TYPE_I</span> (32%<span class="id">Z</span>), <span class="id">EXP_Integer</span> 0)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">patternMkGEPAtIx</span> 0) <span class="id">None</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IVoid</span> 1%<span class="id">Z</span>, <span class="id">INSTR_Store</span>  <span class="id">false</span> (<span class="id">TYPE_I</span> (32%<span class="id">Z</span>), <span class="id">EXP_Integer</span> 1) (<span class="id">patternMkGEPAtIx</span> 1) <span class="id">None</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IId</span> (<span class="id">Name</span> "<span class="id">xat0</span>"), <span class="id">INSTR_Load</span> <span class="id">false</span> (<span class="id">TYPE_I</span> (32%<span class="id">Z</span>)) (<span class="id">patternMkGEPAtIx</span> 0) <span class="id">None</span>)].<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">codeAfterRewrite</span> : <span class="id">code</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[(<span class="id">IId</span> (<span class="id">Name</span> "<span class="id">x</span>"), <span class="id">INSTR_Alloca</span> <span class="id">i32PTRTY</span> (<span class="id">Some</span> ((<span class="id">TYPE_I</span> (32%<span class="id">Z</span>)),  <span class="id">EXP_Integer</span> 0)) <span class="id">None</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IVoid</span> 1%<span class="id">Z</span>, <span class="id">INSTR_Store</span>  <span class="id">false</span> (<span class="id">TYPE_I</span> (32%<span class="id">Z</span>), <span class="id">EXP_Integer</span> 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">patternMkGEPAtIx</span> 1) <span class="id">None</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IVoid</span> 0%<span class="id">Z</span>, <span class="id">INSTR_Store</span>  <span class="id">false</span> (<span class="id">TYPE_I</span> (32%<span class="id">Z</span>), <span class="id">EXP_Integer</span> 0) (<span class="id">patternMkGEPAtIx</span> 0) <span class="id">None</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IId</span> (<span class="id">Name</span> "<span class="id">xat0</span>"), <span class="id">INSTR_Load</span> <span class="id">false</span> (<span class="id">TYPE_I</span> (32%<span class="id">Z</span>)) (<span class="id">patternMkGEPAtIx</span> 0) <span class="id">None</span>)].<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">no_code_match_pattern_implies_no_rewrite</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">c</span>: <span class="id">code</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">NOMATCH</span>: <span class="id">c</span> &lt;&gt; <span class="id">codeToMatch</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bb</span>: <span class="id">block</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">C_IS_CODE_BB</span>: <span class="id">blk_code</span> <span class="id">bb</span> = <span class="id">c</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite_main_bb</span>  <span class="id">bb</span> = <span class="id">None</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof301')">Proof.</div>
<div class="proofscript" id="proof301">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">bb</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rewrite_main_bb</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">blk_phis</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">blk_code</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
Admitted.</div>
<br/>
<span class="kwd">Definition</span> <span class="id">termToMatch</span> : <span class="id">instr_id</span> * <span class="id">terminator</span> :=<br/>
&nbsp;&nbsp;(<span class="id">IVoid</span> 2%<span class="id">Z</span>, <span class="id">TERM_Ret</span> (<span class="id">i32TY</span>, (<span class="id">EXP_Ident</span> (<span class="id">ID_Local</span> (<span class="id">Name</span> "<span class="id">xat0</span>"))))).<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">no_term_match_pattern_implies_no_rewrite</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">t</span>: <span class="id">instr_id</span> *<span class="id">terminator</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">NOMATCH</span>: <span class="id">t</span> &lt;&gt; <span class="id">termToMatch</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">bb</span>: <span class="id">block</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">C_IS_CODE_BB</span>: <span class="id">blk_term</span> <span class="id">bb</span> = <span class="id">t</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite_main_bb</span>  <span class="id">bb</span> = <span class="id">None</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof302')">Proof.</div>
<div class="proofscript" id="proof302">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rewrite_main_bb</span>.<br/>
Admitted.</div>
&nbsp;&nbsp;<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">m_globals_equals</span>: <span class="kwd">forall</span> (<span class="id">CFG</span>: <span class="id">mcfg</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m_globals</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>) = <span class="id">m_globals</span> <span class="id">CFG</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof303')">Proof.</div>
<div class="proofscript" id="proof303">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">CFG</span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">m_globals_equals</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">m_globals_equals</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">m_declaration_equals</span>: <span class="kwd">forall</span> (<span class="id">CFG</span>: <span class="id">mcfg</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m_declarations</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>)  = <span class="id">m_declarations</span> <span class="id">CFG</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof304')">Proof.</div>
<div class="proofscript" id="proof304">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">CFG</span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">m_declaration_equals</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">m_declaration_equals</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">preserves_prototypes</span>: <span class="kwd">forall</span> (<span class="id">CFG</span>: <span class="id">mcfg</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">map</span> <span class="id">df_prototype</span> (<span class="id">m_definitions</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>)) = <span class="id">map</span> <span class="id">df_prototype</span> (<span class="id">m_definitions</span> <span class="id">CFG</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof305')">Proof.</div>
<div class="proofscript" id="proof305">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">CFG</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m_globals</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m_declarations</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m_definitions</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m_definitions</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rewrite_main_definition</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">dc_name</span> (<span class="id">df_prototype</span> <span class="id">d</span>) == <span class="id">Name</span> "<span class="id">main</span>"); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">m_declaration_equals</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">m_declaration_equals</span>.<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">allocate_globals_equals</span>: <span class="kwd">forall</span> (<span class="id">CFG</span>: <span class="id">mcfg</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TopLevel.SS.allocate_globals</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>) (<span class="id">m_globals</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>)) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TopLevel.SS.allocate_globals</span> <span class="id">CFG</span> (<span class="id">m_globals</span> <span class="id">CFG</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof306')">Proof.</div>
<div class="proofscript" id="proof306">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">TopLevel.SS.allocate_globals</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">m_globals_equals</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">m_globals</span> <span class="id">CFG</span>); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">allocate_globals_equals</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">allocate_globals_equals</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">find_function_equals</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">CFG</span>: <span class="id">mcfg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">globals</span> : <span class="id">m_globals</span> <span class="id">CFG</span> = [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">declarations</span> : <span class="id">m_declarations</span> <span class="id">CFG</span> = [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">d</span> : <span class="id">definition</span> <span class="id">cfg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">definitions</span> : <span class="id">m_definitions</span> <span class="id">CFG</span> = [<span class="id">d</span>]),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_function</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>) (<span class="id">Name</span> "<span class="id">main</span>") =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">option_map</span> (<span class="kwd">fun</span> <span class="id">d</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">df_prototype</span> <span class="id">d</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">df_args</span> <span class="id">d</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">rewrite_main_cfg</span> (<span class="id">df_instrs</span> <span class="id">d</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">find_function</span> <span class="id">CFG</span> (<span class="id">Name</span> "<span class="id">main</span>")) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">d0</span>, <span class="id">find_function</span> <span class="id">CFG</span> (<span class="id">Name</span> "<span class="id">main</span>") = <span class="id">Some</span> <span class="id">d0</span> -&gt; <span class="id">d0</span> = <span class="id">d</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof307')">Proof.</div>
<div class="proofscript" id="proof307">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">find_function</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">definitions</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rewrite_mcfg</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m_globals</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m_declarations</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m_definitions</span>; <span class="tactic">try</span> <span class="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">definitions</span>.<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">find_defn</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ident_of</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ident_of_definition</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ident_of</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rewrite_main_definition</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">ident_of_declaration</span>.<br/>
&nbsp;&nbsp;<span class="tactic">split</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">dc_name</span> (<span class="id">df_prototype</span> <span class="id">d</span>) == <span class="id">Name</span> "<span class="id">main</span>") <span class="id">eqn</span>:<span class="id">name</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">e</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ID_Global</span> (<span class="id">Name</span> "<span class="id">main</span>") == <span class="id">ID_Global</span> (<span class="id">Name</span> "<span class="id">main</span>")) <span class="id">eqn</span>:<span class="id">eqrefl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ID_Global</span> (<span class="id">dc_name</span> (<span class="id">df_prototype</span> <span class="id">d</span>)) == <span class="id">ID_Global</span> (<span class="id">Name</span> "<span class="id">main</span>"));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">ID_Global</span> (<span class="id">dc_name</span> (<span class="id">df_prototype</span> <span class="id">d</span>)) == <span class="id">ID_Global</span> (<span class="id">Name</span> "<span class="id">main</span>"));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">find_function_equals</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">find_function_equals</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">find_function_entry_equals</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">CFG</span>: <span class="id">mcfg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">globals</span> : <span class="id">m_globals</span> <span class="id">CFG</span> = [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">declarations</span> : <span class="id">m_declarations</span> <span class="id">CFG</span> = [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">d</span> : <span class="id">definition</span> <span class="id">cfg</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">definitions</span> : <span class="id">m_definitions</span> <span class="id">CFG</span> = [<span class="id">d</span>]),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">find_function_entry</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>) (<span class="id">Name</span> "<span class="id">main</span>") =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_function_entry</span> <span class="id">CFG</span> (<span class="id">Name</span> "<span class="id">main</span>")).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof308')">Proof.</div>
<div class="proofscript" id="proof308">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">find_function_entry</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">FIND_FN</span>: <span class="id">find_function</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>) (<span class="id">Name</span> "<span class="id">main</span>") =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">option_map</span> (<span class="kwd">fun</span> <span class="id">d</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">df_prototype</span> <span class="id">d</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">df_args</span> <span class="id">d</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">rewrite_main_cfg</span> (<span class="id">df_instrs</span> <span class="id">d</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">find_function</span> <span class="id">CFG</span> (<span class="id">Name</span> "<span class="id">main</span>")) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">d0</span>, <span class="id">find_function</span> <span class="id">CFG</span> (<span class="id">Name</span> "<span class="id">main</span>") = <span class="id">Some</span> <span class="id">d0</span> -&gt; <span class="id">d0</span> = <span class="id">d</span>)).<br/>
&nbsp;&nbsp;<span class="tactic">eauto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">FIND_FN</span> <span class="kwd">as</span> [<span class="id">REWRITE_FN</span>  <span class="id">ORIGINAL_FN</span>].<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">find_function</span> <span class="id">CFG</span> (<span class="id">Name</span> "<span class="id">main</span>")) <span class="id">eqn</span>:<span class="id">FINDFN</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">REWRITE_FN</span>; <span class="tactic">auto</span>.<br/>
<br/>
<div class="doc">We want a winess of d0 = d *</div>
&nbsp;&nbsp;<span class="id">specialize</span> (<span class="id">ORIGINAL_FN</span> <span class="id">d0</span> <span class="id">eq_refl</span>).<br/>
&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">blks</span> (<span class="id">df_instrs</span> <span class="id">d</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rewrite_main_bb</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">blk_phis</span> <span class="id">b</span>); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">CODE_CASES</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">blk_code</span> <span class="id">b</span> = <span class="id">codeToMatch</span>} + {<span class="id">blk_code</span> <span class="id">b</span> &lt;&gt; <span class="id">codeToMatch</span>}); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">CODE_CASES</span> <span class="kwd">as</span> [<span class="id">CODE_MATCH</span> | <span class="id">CODE_NOMATCH</span>]; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">unfold</span> <span class="id">codeToMatch</span> <span class="kwd">in</span> <span class="id">CODE_MATCH</span>. <span class="tactic">inversion</span> <span class="id">CODE_MATCH</span> <span class="kwd">as</span> [<span class="id">BB_CODE</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">BB_CODE</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">TERM_CASES</span>: {<span class="id">blk_term</span> <span class="id">b</span> = <span class="id">termToMatch</span>} +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">blk_term</span> <span class="id">b</span> &lt;&gt; <span class="id">termToMatch</span>}); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
Abort.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">register_functions_equal</span>: <span class="kwd">forall</span> (<span class="id">CFG</span>: <span class="id">mcfg</span>) (<span class="id">ge</span>: <span class="id">TopLevel.SS.genv</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TopLevel.SS.register_functions</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>) <span class="id">ge</span> ≡<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TopLevel.SS.register_functions</span> (<span class="id">CFG</span>) <span class="id">ge</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof309')">Proof.</div>
<div class="proofscript" id="proof309">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">TopLevel.SS.register_functions</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m_globals</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m_declarations</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">m_definitions</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>. <span class="tactic">simpl</span>. <span class="tactic">unfold</span> <span class="id">rewrite_main_definition</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">dc_name</span> <span class="id">df_prototype</span> == <span class="id">Name</span> "<span class="id">main</span>"); <span class="tactic">try</span> <span class="tactic">reflexivity</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">register_functions_equal</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Rewrite</span> <span class="id">register_functions_equal</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">rewrite_main_cfg_cases</span>: <span class="kwd">forall</span> <span class="id">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite_main_cfg</span> <span class="id">c</span> = <span class="id">c</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span> <span class="id">bnew</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite_main_bb</span> <span class="id">b</span> = <span class="id">Some</span> <span class="id">bnew</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blks</span> <span class="id">c</span> = [<span class="id">b</span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite_main_cfg</span> <span class="id">c</span> =  {| <span class="id">init</span> := <span class="id">init</span> <span class="id">c</span>; <span class="id">blks</span> := [<span class="id">bnew</span>]; <span class="id">args</span> := <span class="id">args</span> <span class="id">c</span> |} /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk_code</span> <span class="id">b</span> = <span class="id">codeToMatch</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk_term</span> <span class="id">b</span> = <span class="id">termToMatch</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk_phis</span> <span class="id">b</span> = [].<br/>
<div class="toggleproof" onclick="toggleDisplay('proof310')">Proof.</div>
<div class="proofscript" id="proof310">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rewrite_main_cfg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">c</span> <span class="id">eqn</span>:<span class="id">CVAL</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">blks</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">blks</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">CODE_CASES</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">blk_code</span> <span class="id">b</span> = <span class="id">codeToMatch</span>} + {<span class="id">blk_code</span> <span class="id">b</span> &lt;&gt; <span class="id">codeToMatch</span>}); <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">TERM_CASES</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id">blk_term</span> <span class="id">b</span> = <span class="id">termToMatch</span>} + {<span class="id">blk_term</span> <span class="id">b</span> &lt;&gt; <span class="id">termToMatch</span>}); <span class="tactic">auto</span>.<br/>
&nbsp;need&nbsp;terminator&nbsp;decidable&nbsp;equality&nbsp;*)</span>&nbsp;&nbsp;<span class="id">admit</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">CODE_CASES</span> <span class="kwd">as</span> [<span class="id">CODE_MATCH</span> | <span class="id">CODE_NOMATCH</span>].<br/>
&nbsp;&nbsp;- <span class="comment">(**&nbsp;CODE&nbsp;MATCHED&nbsp;**)</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">TERM_CASES</span> <span class="kwd">as</span> [<span class="id">TERM_MATCH</span> | <span class="id">TERM_NOMATCH</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(**&nbsp;TERM&nbsp;MATCHED&nbsp;**)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rewrite_main_bb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">blk_phis</span> <span class="id">b</span>) <span class="id">eqn</span>:<span class="id">PHIS</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">CODE_MATCH</span>. <span class="tactic">unfold</span> <span class="id">codeToMatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">TERM_MATCH</span>. <span class="tactic">unfold</span> <span class="id">termToMatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">isGEPAtIx</span>, <span class="id">patternMkGEPAtIx</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">esplit</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PHIS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">CODE_MATCH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">TERM_MATCH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">codeToMatch</span>, <span class="id">termToMatch</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">patternMkGEPAtIx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+  <span class="tactic">assert</span> (<span class="id">REWRITE_BB</span>: <span class="id">rewrite_main_bb</span> <span class="id">b</span> = <span class="id">None</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">no_term_match_pattern_implies_no_rewrite</span> <span class="kwd">with</span> (<span class="id">t</span> := <span class="id">blk_term</span> <span class="id">b</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">REWRITE_BB</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;- <span class="tactic">assert</span> (<span class="id">REWRITE_BB</span>: <span class="id">rewrite_main_bb</span> <span class="id">b</span> = <span class="id">None</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">no_code_match_pattern_implies_no_rewrite</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">REWRITE_BB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<div class="doc">Admitted because I need decidable equality on terminators *</div>
Admitted.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">exec_new_program</span>: <span class="kwd">forall</span> <br/>
&nbsp;&nbsp;(<span class="id">CFG</span> : <span class="id">mcfg</span>)<br/>
&nbsp;&nbsp;(<span class="id">globals</span> : <span class="id">m_globals</span> <span class="id">CFG</span> = [])<br/>
&nbsp;&nbsp;(<span class="id">declarations</span> : <span class="id">m_declarations</span> <span class="id">CFG</span> = [])<br/>
&nbsp;&nbsp;(<span class="id">df_prototype</span> : <span class="id">declaration</span>)<br/>
&nbsp;&nbsp;(<span class="id">df_args</span> : <span class="id">list</span> <span class="id">local_id</span>)<br/>
&nbsp;&nbsp;(<span class="id">df_instrs</span> : <span class="id">cfg</span>)<br/>
&nbsp;&nbsp;(<span class="id">definitions</span> : <span class="id">m_definitions</span> <span class="id">CFG</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">df_prototype</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">df_args</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">df_instrs</span> |}])<br/>
&nbsp;&nbsp;(<span class="id">FINDFN_REWRITE</span> : <span class="id">find_function</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>) (<span class="id">Name</span> "<span class="id">main</span>") =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">LLVMAst.df_prototype</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">df_prototype</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">df_args</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">df_instrs</span> |};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">LLVMAst.df_args</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">df_prototype</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">df_args</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">df_instrs</span> |};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">rewrite_main_cfg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LLVMAst.df_instrs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">df_prototype</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">df_args</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">df_instrs</span> |}) |})<br/>
&nbsp;&nbsp;(<span class="id">bold</span> <span class="id">bnew</span> : <span class="id">block</span>)<br/>
&nbsp;&nbsp;(<span class="id">REWRITE_WITNESS</span> : <span class="id">rewrite_main_bb</span> <span class="id">bold</span> = <span class="id">Some</span> <span class="id">bnew</span>)<br/>
&nbsp;&nbsp;(<span class="id">BBS</span> : <span class="id">blks</span> <span class="id">df_instrs</span> = [<span class="id">bold</span>])<br/>
&nbsp;&nbsp;(<span class="id">REWRITE_MAIN_CFG</span> : <span class="id">rewrite_main_cfg</span> <span class="id">df_instrs</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">init</span> := <span class="id">init</span> <span class="id">df_instrs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blks</span> := [<span class="id">bnew</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">args</span> := <span class="id">args</span> <span class="id">df_instrs</span> |})<br/>
&nbsp;&nbsp;(<span class="id">CODE_OLD</span> : <span class="id">blk_code</span> <span class="id">bold</span> = <span class="id">codeToMatch</span>)<br/>
&nbsp;&nbsp;(<span class="id">TERM_OLD</span> : <span class="id">blk_term</span> <span class="id">bold</span> = <span class="id">termToMatch</span>)<br/>
&nbsp;&nbsp;(<span class="id">PHIS_OLD</span> : <span class="id">blk_phis</span> <span class="id">bold</span> = [])<br/>
&nbsp;&nbsp;(<span class="id">BLK_ID_SAME</span> : <span class="id">blk_id</span> <span class="id">bnew</span> = <span class="id">blk_id</span> <span class="id">bold</span>)<br/>
&nbsp;&nbsp;(<span class="id">BLKID_INIT</span> : <span class="id">blk_id</span> <span class="id">bold</span> = <span class="id">init</span> <span class="id">df_instrs</span>),<br/>
&nbsp;&nbsp;<span class="id">M.memD</span> (<span class="id">M.add</span> (<span class="id">M.size</span> (<span class="id">a</span>:=<span class="id">Z</span>)(<span class="id">M.empty</span>)) (<span class="id">M.make_empty_block</span> <span class="id">DTYPE_Pointer</span>) <span class="id">M.empty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">step_sem</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Step</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ENV.add</span> (<span class="id">dc_name</span> <span class="id">df_prototype</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">IO.DV.DVALUE_Addr</span> (<span class="id">M.size</span> (<span class="id">a</span>:=<span class="id">Z</span>)<span class="id">M.empty</span>, 0)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ENV.empty</span> <span class="id">IO.DV.dvalue</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fn</span> := <span class="id">Name</span> "<span class="id">main</span>";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bk</span> := <span class="id">init</span> <span class="id">df_instrs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pt</span> := <span class="id">blk_entry_id</span> <span class="id">bnew</span> |}, <span class="id">ENV.empty</span> <span class="id">IO.DV.dvalue</span>, []))) ≡<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Ret</span> (<span class="id">IO.DV.DVALUE_I32</span>  (<span class="id">Int32.repr</span> 0%<span class="id">Z</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof311')">Proof.</div>
<div class="proofscript" id="proof311">
&nbsp;&nbsp;<span class="id">Opaque</span> <span class="id">M.add_all_index</span>.<br/>
&nbsp;&nbsp;<span class="id">Opaque</span> <span class="id">M.lookup_all_index</span>.<br/>
&nbsp;&nbsp;<span class="id">Opaque</span> <span class="id">rewrite_main_cfg</span>.<br/>
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">forcestepsem</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">FINDFN_REWRITE</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">REWRITE_MAIN_CFG</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">BLK_ID_SAME</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">BLKID_INIT</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">init</span> <span class="id">df_instrs</span> == <span class="id">init</span> <span class="id">df_instrs</span>); <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">BNEW_VAL</span>: <span class="id">bnew</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk_id</span>  := <span class="id">blk_id</span> <span class="id">bold</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk_phis</span> := [];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk_code</span>  := <span class="id">codeAfterRewrite</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk_term</span> := <span class="id">termToMatch</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}).<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">BLK_ID_NEW_IS_INIT</span>: <span class="id">blk_id</span> <span class="id">bnew</span> = <span class="id">init</span> <span class="id">df_instrs</span>).<br/>
&nbsp;&nbsp;<span class="tactic">congruence</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rewrite_main_bb</span> <span class="kwd">in</span> <span class="id">REWRITE_WITNESS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">PHIS_OLD</span>, <span class="id">CODE_OLD</span>, <span class="id">TERM_OLD</span> <span class="kwd">in</span> <span class="id">REWRITE_WITNESS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">codeToMatch</span>, <span class="id">termToMatch</span> <span class="kwd">in</span> <span class="id">REWRITE_WITNESS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">REWRITE_WITNESS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">REWRITE_WITNESS</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">codeAfterRewrite</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">termToMatch</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">do</span> 100? [<span class="tactic">rewrite</span> <span class="id">BNEW_VAL</span>; <span class="tactic">simpl</span> | <span class="tactic">rewrite</span> <span class="id">FINDFN_REWRITE</span>; <span class="tactic">simpl</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">REWRITE_MAIN_CFG</span>; <span class="tactic">simpl</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> ( <span class="kwd">if</span> <span class="id">blk_id</span> <span class="id">bold</span> == <span class="id">init</span> <span class="id">df_instrs</span> <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">true</span>; <span class="tactic">try</span> (<span class="tactic">destruct</span> (<span class="id">blk_id</span> <span class="id">bold</span> == <span class="id">init</span> <span class="id">df_instrs</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">auto</span>) |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">progress</span> (<span class="tactic">unfold</span> <span class="id">block_to_cmd</span>; <span class="tactic">simpl</span>) |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">progress</span> <span class="id">euttnorm</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">progress</span> (<span class="tactic">unfold</span> <span class="id">cont</span>; <span class="tactic">simpl</span>; <span class="id">M.forcememd</span>; <span class="id">euttnorm</span>; <span class="id">forcestepsem</span>) |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eval_type_I32</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eval_type_array_i32</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">progress</span> <span class="id">M.forcememd</span>].<br/>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (2 &lt;=? <span class="id">Int32.unsigned</span> (<span class="id">Int32.repr</span> 0)) <span class="kwd">with</span> <span class="id">false</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (2 &lt;=? <span class="id">Int32.unsigned</span> (<span class="id">Int32.repr</span> 1)) <span class="kwd">with</span> <span class="id">false</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">Int32.unsigned</span> (<span class="id">Int32.repr</span> 0)) <span class="kwd">with</span> 0;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">Int32.unsigned</span> (<span class="id">Int32.repr</span> 1)) <span class="kwd">with</span> 1; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">cbn</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
&nbsp;&nbsp;<span class="id">forcestepsem</span>.<br/>
&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> @<span class="id">Trace.matchM</span> <span class="kwd">with</span> (<span class="id">i</span> := <span class="id">M.memD</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">M.lookup_all_index_of_add_all_index_full_alias</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Lemma</span> <span class="id">exec_old_program</span>: <span class="kwd">forall</span><br/>
&nbsp;&nbsp;(<span class="id">CFG</span> : <span class="id">mcfg</span>)<br/>
&nbsp;&nbsp;(<span class="id">globals</span> : <span class="id">m_globals</span> <span class="id">CFG</span> = [])<br/>
&nbsp;&nbsp;(<span class="id">declarations</span> : <span class="id">m_declarations</span> <span class="id">CFG</span> = [])<br/>
&nbsp;&nbsp;(<span class="id">df_prototype</span> : <span class="id">declaration</span>)<br/>
&nbsp;&nbsp;(<span class="id">df_args</span> : <span class="id">list</span> <span class="id">local_id</span>)<br/>
&nbsp;&nbsp;(<span class="id">df_instrs</span> : <span class="id">cfg</span>)<br/>
&nbsp;&nbsp;(<span class="id">definitions</span> : <span class="id">m_definitions</span> <span class="id">CFG</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">df_prototype</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">df_args</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">df_instrs</span> |}])<br/>
<br/>
&nbsp;&nbsp;(<span class="id">FINDMAIN</span> : <span class="id">find_function</span> <span class="id">CFG</span> (<span class="id">Name</span> "<span class="id">main</span>") =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">df_prototype</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">df_args</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">df_instrs</span> |})<br/>
&nbsp;&nbsp;(<span class="id">FINDFN_REWRITE</span> : <span class="id">find_function</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>) (<span class="id">Name</span> "<span class="id">main</span>") =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">LLVMAst.df_prototype</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">df_prototype</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">df_args</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">df_instrs</span> |};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">LLVMAst.df_args</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">df_prototype</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">df_args</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">df_instrs</span> |};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">rewrite_main_cfg</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">LLVMAst.df_instrs</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">df_prototype</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">df_args</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">df_instrs</span> |}) |})<br/>
&nbsp;&nbsp;(<span class="id">bold</span> <span class="id">bnew</span> : <span class="id">block</span>)<br/>
&nbsp;&nbsp;(<span class="id">REWRITE_WITNESS</span> : <span class="id">rewrite_main_bb</span> <span class="id">bold</span> = <span class="id">Some</span> <span class="id">bnew</span>)<br/>
&nbsp;&nbsp;(<span class="id">BBS</span> : <span class="id">blks</span> <span class="id">df_instrs</span> = [<span class="id">bold</span>])<br/>
&nbsp;&nbsp;(<span class="id">REWRITE_MAIN_CFG</span> : <span class="id">rewrite_main_cfg</span> <span class="id">df_instrs</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">init</span> := <span class="id">init</span> <span class="id">df_instrs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blks</span> := [<span class="id">bnew</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">args</span> := <span class="id">args</span> <span class="id">df_instrs</span> |})<br/>
&nbsp;&nbsp;(<span class="id">CODE_OLD</span> : <span class="id">blk_code</span> <span class="id">bold</span> = <span class="id">codeToMatch</span>)<br/>
&nbsp;&nbsp;(<span class="id">TERM_OLD</span> : <span class="id">blk_term</span> <span class="id">bold</span> = <span class="id">termToMatch</span>)<br/>
&nbsp;&nbsp;(<span class="id">PHIS_OLD</span> : <span class="id">blk_phis</span> <span class="id">bold</span> = [])<br/>
&nbsp;&nbsp;(<span class="id">BLK_ID_SAME</span> : <span class="id">blk_id</span> <span class="id">bnew</span> = <span class="id">blk_id</span> <span class="id">bold</span>)<br/>
&nbsp;&nbsp;(<span class="id">BLKID_INIT</span> : <span class="id">blk_id</span> <span class="id">bold</span> = <span class="id">init</span> <span class="id">df_instrs</span>),<br/>
&nbsp;&nbsp;<span class="id">M.memD</span> (<span class="id">M.add</span> (<span class="id">M.size</span> (<span class="id">a</span>:=<span class="id">Z</span>)<span class="id">M.empty</span>) (<span class="id">M.make_empty_block</span> <span class="id">DTYPE_Pointer</span>) <span class="id">M.empty</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">step_sem</span> <span class="id">CFG</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Step</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ENV.add</span> (<span class="id">dc_name</span> <span class="id">df_prototype</span>) (<span class="id">DVALUE_Addr</span> (<span class="id">M.size</span> (<span class="id">a</span>:=<span class="id">Z</span>) <span class="id">M.empty</span>, 0))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">ENV.empty</span> <span class="id">dvalue</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fn</span> := <span class="id">Name</span> "<span class="id">main</span>";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bk</span> := <span class="id">init</span> <span class="id">df_instrs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pt</span> := <span class="id">blk_entry_id</span> <span class="id">bold</span> |}, <span class="id">ENV.empty</span> <span class="id">dvalue</span>, []))) ≡<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Ret</span> (<span class="id">IO.DV.DVALUE_I32</span>  (<span class="id">Int32.repr</span> 0%<span class="id">Z</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof312')">Proof.</div>
<div class="proofscript" id="proof312">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id">forcestepsem</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">FINDMAIN</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">find_block</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">BBS</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> ( <span class="kwd">if</span> <span class="id">blk_id</span> <span class="id">bold</span> == <span class="id">init</span> <span class="id">df_instrs</span> <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">true</span>; <span class="tactic">try</span> (<span class="tactic">destruct</span> (<span class="id">blk_id</span> <span class="id">bold</span> == <span class="id">init</span> <span class="id">df_instrs</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">auto</span>).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">block_to_cmd</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">TERM_ID_NEQ_ENTRY_ID</span>: <span class="id">blk_term_id</span> <span class="id">bold</span> &lt;&gt; <span class="id">blk_entry_id</span> <span class="id">bold</span> ).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">blk_term_id</span>, <span class="id">blk_entry_id</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">TERM_OLD</span>, <span class="id">CODE_OLD</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">termToMatch</span>, <span class="id">codeToMatch</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">ENTRY_ID_VAL</span>: <span class="id">blk_entry_id</span> <span class="id">bold</span> = <span class="id">IId</span> (<span class="id">Name</span> "<span class="id">x</span>")).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">blk_entry_id</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">CODE_OLD</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">fallthrough</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">codeToMatch</span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">TERM_ID_VAL</span>: <span class="id">blk_term_id</span> <span class="id">bold</span> = <span class="id">IVoid</span> 2).<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">blk_term_id</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">TERM_OLD</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">termToMatch</span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">blk_term_id</span> <span class="id">bold</span> == <span class="id">blk_entry_id</span> <span class="id">bold</span>); <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">CODE_OLD</span>. <span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">blk_entry_id</span> <span class="id">bold</span> == <span class="id">IId</span> (<span class="id">Name</span> "<span class="id">x</span>")); <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">FINDMAIN</span>; <span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">progress</span> <span class="tactic">unfold</span> <span class="id">find_block</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">BBS</span>; <span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> ( <span class="kwd">if</span> <span class="id">blk_id</span> <span class="id">bold</span> == <span class="id">init</span> <span class="id">df_instrs</span> <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">true</span>; <span class="tactic">try</span> (<span class="tactic">destruct</span> (<span class="id">blk_id</span> <span class="id">bold</span> == <span class="id">init</span> <span class="id">df_instrs</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">auto</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">block_to_cmd</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">blk_term_id</span> <span class="id">bold</span> == <span class="id">blk_entry_id</span> <span class="id">bold</span>); <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">CODE_OLD</span>. <span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">blk_entry_id</span> <span class="id">bold</span> == <span class="id">IId</span> (<span class="id">Name</span> "<span class="id">x</span>")); <span class="tactic">try</span> <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">blk_entry_id</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">CODE_OLD</span>. <span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
&nbsp;&nbsp;<br/>
<br/>
<br/>
Error:<br/>
Anomaly<br/>
"File&nbsp;"plugins/ltac/tacinterp.ml",&nbsp;line&nbsp;1157,&nbsp;characters&nbsp;35-41:&nbsp;Assertion&nbsp;failed."<br/>
Please&nbsp;report&nbsp;at&nbsp;http://coq.inria.fr/bugs/.<br/>
&nbsp;&nbsp;&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">do</span> 100? [<span class="tactic">progress</span> (<span class="tactic">unfold</span> <span class="id">cont</span>; <span class="tactic">simpl</span>; <span class="id">M.forcememd</span>; <span class="id">euttnorm</span>; <span class="id">forcestepsem</span>) |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">FINDMAIN</span>; <span class="tactic">simpl</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">progress</span> <span class="tactic">unfold</span> <span class="id">find_block</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">BBS</span>; <span class="tactic">simpl</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> ( <span class="kwd">if</span> <span class="id">blk_id</span> <span class="id">bold</span> == <span class="id">init</span> <span class="id">df_instrs</span> <span class="kwd">then</span> <span class="id">true</span> <span class="kwd">else</span> <span class="id">false</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">with</span> <span class="id">true</span>; <span class="tactic">try</span> (<span class="tactic">destruct</span> (<span class="id">blk_id</span> <span class="id">bold</span> == <span class="id">init</span> <span class="id">df_instrs</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">auto</span>) |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">progress</span> (<span class="tactic">unfold</span> <span class="id">block_to_cmd</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id">context</span> [<span class="id">blk_term_id</span> <span class="id">bold</span> == <span class="id">blk_term_id</span> <span class="id">bold</span>]] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">blk_term_id</span> <span class="id">bold</span> == <span class="id">blk_term_id</span> <span class="id">bold</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="tactic">fail</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">TERM_OLD</span>; <span class="tactic">simpl</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">progress</span> (<span class="tactic">unfold</span> <span class="id">block_to_cmd</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id">context</span> [<span class="id">blk_term_id</span> <span class="id">bold</span> == <span class="id">blk_entry_id</span> <span class="id">bold</span>]] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">blk_term_id</span> <span class="id">bold</span> == <span class="id">blk_entry_id</span> <span class="id">bold</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">contradiction</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">CODE_OLD</span>; <span class="tactic">simpl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="tactic">fail</span> "<span class="id">no</span> <span class="kwd">match</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) | <br/>
<br/>
&nbsp;This&nbsp;will&nbsp;not&nbsp;work,&nbsp;use&nbsp;context&nbsp;pattern&nbsp;matches&nbsp;to&nbsp;get&nbsp;to&nbsp;the<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;part&nbsp;of&nbsp;the&nbsp;proof&nbsp;which&nbsp;matters<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http://adam.chlipala.net/cpdt/html/Cpdt.Match.html<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">progress</span> (<span class="tactic">unfold</span> <span class="id">block_to_cmd</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ |- <span class="id">context</span>[(<span class="id">blk_term_id</span> <span class="id">bold</span> ==  ?<span class="id">X</span>)]] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">blk_term_id</span> <span class="id">bold</span> ==  <span class="id">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">as</span> [<span class="id">TERM_ID_VAL</span>' | ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">TERM_ID_VAL</span>' <span class="kwd">in</span> <span class="id">TERM_ID_VAL</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">TERM_ID_VAL</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">fail</span> 10)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">_</span> =&gt; <span class="tactic">fail</span> "<span class="id">no</span> <span class="id">matching</span> <span class="id">goal</span>"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>) |<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eval_type_I32</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">eval_type_array_i32</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">CODE_OLD</span>; <span class="tactic">simpl</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">progress</span> <span class="id">euttnorm</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">progress</span> <span class="id">M.forcememd</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">progress</span> <span class="id">forcestepsem</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">progress</span> (<span class="tactic">unfold</span> <span class="id">cont</span>)].<br/>
<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (2 &lt;=? <span class="id">Int32.unsigned</span> (<span class="id">Int32.repr</span> 0)) <span class="kwd">with</span> <span class="id">false</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (2 &lt;=? <span class="id">Int32.unsigned</span> (<span class="id">Int32.repr</span> 1)) <span class="kwd">with</span> <span class="id">false</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">Int32.unsigned</span> (<span class="id">Int32.repr</span> 0)) <span class="kwd">with</span> 0;<span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">Int32.unsigned</span> (<span class="id">Int32.repr</span> 1)) <span class="kwd">with</span> 1; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">cbn</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
&nbsp;&nbsp;<span class="id">forcestepsem</span>.<br/>
&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> @<span class="id">Trace.matchM</span> <span class="kwd">with</span> (<span class="id">i</span> := <span class="id">M.memD</span> <span class="id">_</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">M.lookup_all_index_of_add_all_index_no_alias</span>); <span class="tactic">auto</span>; <span class="tactic">try</span> <span class="tactic">omega</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> (<span class="id">M.lookup_all_index_of_add_all_index_full_alias</span>); <span class="tactic">auto</span>.<br/>
Qed.</div>
&nbsp;&nbsp;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">preserves_semantics</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">CFG</span>: <span class="id">mcfg</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">run_mcfg_with_memory</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>)) ≡ (<span class="id">run_mcfg_with_memory</span> <span class="id">CFG</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof313')">Proof.</div>
<div class="proofscript" id="proof313">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">run_mcfg_with_memory</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">TopLevel.SS.init_state</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">TopLevel.SS.build_global_environment</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">m_globals_equals</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">allocate_globals_equals</span>.<br/>
<div class="doc">Discard one choice of globals since we do nothing *</div>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">m_globals</span> <span class="id">CFG</span>) <span class="id">eqn</span>:<span class="id">globals</span>;  <span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id">rewrite_mcfg</span>; <span class="tactic">destruct</span> <span class="id">CFG</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">globals</span>; <span class="tactic">reflexivity</span>).<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">TopLevel.SS.allocate_globals</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">register_functions_equal</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">TopLevel.SS.register_functions</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
<br/>
<div class="doc">Show for both choices of declarations </div>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">m_declarations</span> <span class="id">CFG</span>) <span class="id">eqn</span>:<span class="id">declarations</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id">rewrite_mcfg</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">globals</span>, <span class="id">declarations</span>; <span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
<div class="doc">Discard the case where definitions is empty *</div>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">m_definitions</span> <span class="id">CFG</span>) <span class="id">eqn</span>:<span class="id">definitions</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id">rewrite_mcfg</span>; <span class="tactic">destruct</span> <span class="id">CFG</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">globals</span>, <span class="id">declarations</span>, <span class="id">definitions</span>; <span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>).<br/>
<br/>
&nbsp;&nbsp;<br/>
<div class="doc">Discard the case where definitions is too large *</div>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">l</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">unfold</span> <span class="id">rewrite_mcfg</span>; <span class="tactic">destruct</span> <span class="id">CFG</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">rewrite</span> <span class="id">globals</span>, <span class="id">declarations</span>, <span class="id">definitions</span>; <span class="tactic">simpl</span>; <span class="tactic">reflexivity</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">register_declaration</span>.<br/>
&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">M.forcememd</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">euttnorm</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">initialize_globals</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">euttnorm</span>.<br/>
<br/>
<div class="doc">Find function entry *</div>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">find_function_entry</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">FINDFN</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find_function</span> (<span class="id">rewrite_mcfg</span> <span class="id">CFG</span>) (<span class="id">Name</span> "<span class="id">main</span>") =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">option_map</span> (<span class="kwd">fun</span> <span class="id">d</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_prototype</span> := <span class="id">df_prototype</span> <span class="id">d</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_args</span> := <span class="id">df_args</span> <span class="id">d</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">df_instrs</span> := <span class="id">rewrite_main_cfg</span> (<span class="id">df_instrs</span> <span class="id">d</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|})<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">find_function</span> <span class="id">CFG</span> (<span class="id">Name</span> "<span class="id">main</span>")) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">d0</span>, <span class="id">find_function</span> <span class="id">CFG</span> (<span class="id">Name</span> "<span class="id">main</span>") = <span class="id">Some</span> <span class="id">d0</span> -&gt; <span class="id">d0</span> = <span class="id">d</span>)); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">FINDFN</span> <span class="kwd">as</span> [<span class="id">FINDFN_REWRITE</span> <span class="id">FINDFN_VALUE</span>].<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">find_function</span> <span class="id">CFG</span> (<span class="id">Name</span> "<span class="id">main</span>")) <span class="kwd">as</span> [<span class="id">mainfn</span> | ] <span class="id">eqn</span>:<span class="id">FINDMAIN</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(**&nbsp;FOUND&nbsp;FUNCTION&nbsp;**)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">mainfn</span> = <span class="id">d</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">FINDFN_VALUE</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>.<br/>
<div class="doc">CAREFUL HERE *</div>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">clear</span> <span class="id">FINDFN_VALUE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">FINDFN_REWRITE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">FINDFN_REWRITE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Opaque</span> <span class="id">rewrite_main_cfg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">REWRITE_CASES</span>: <span class="id">rewrite_main_cfg</span> <span class="id">df_instrs</span> = <span class="id">df_instrs</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">b</span> <span class="id">bnew</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite_main_bb</span> <span class="id">b</span> = <span class="id">Some</span> <span class="id">bnew</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blks</span> <span class="id">df_instrs</span> = [<span class="id">b</span>] /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite_main_cfg</span> <span class="id">df_instrs</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{| <span class="id">init</span> := <span class="id">init</span> <span class="id">df_instrs</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blks</span> := [<span class="id">bnew</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">args</span> := <span class="id">args</span> <span class="id">df_instrs</span> |} /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk_code</span> <span class="id">b</span> = <span class="id">codeToMatch</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk_term</span> <span class="id">b</span> = <span class="id">termToMatch</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">blk_phis</span> <span class="id">b</span> = []<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">rewrite_main_cfg_cases</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">REWRITE_CASES</span> <span class="kwd">as</span> [<span class="id">NOREWRITE_CFG</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">bold</span> [<span class="id">bnew</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">REWRITE_WITNESS</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">BBS</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">REWRITE_MAIN_CFG</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id">CODE_OLD</span> [<span class="id">TERM_OLD</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">PHIS_OLD</span>]]]]]]]].<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(**&nbsp;NO&nbsp;REWRITE&nbsp;OF&nbsp;CFG&nbsp;**)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">NOREWRITE_CFG</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">NOREWRITE_MCFG</span>: <span class="id">rewrite_mcfg</span> <span class="id">CFG</span> = <span class="id">CFG</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rewrite_mcfg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">CFG</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">globals</span>, <span class="id">declarations</span>, <span class="id">definitions</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rewrite_main_definition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">dc_name</span> (<span class="id">df_prototype</span>) == <span class="id">Name</span> "<span class="id">main</span>"); <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">NOREWRITE_CFG</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">NOREWRITE_MCFG</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(**&nbsp;REWRITE&nbsp;OF&nbsp;CFG&nbsp;**)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">BBS</span>, <span class="id">REWRITE_MAIN_CFG</span>. <span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">BLK_ID_SAME</span>: <span class="id">blk_id</span> <span class="id">bnew</span> = <span class="id">blk_id</span> <span class="id">bold</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">rewrite_main_bb</span> <span class="kwd">in</span> <span class="id">REWRITE_WITNESS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">CODE_OLD</span>, <span class="id">TERM_OLD</span>, <span class="id">PHIS_OLD</span> <span class="kwd">in</span> <span class="id">REWRITE_WITNESS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">codeToMatch</span>, <span class="id">termToMatch</span> <span class="kwd">in</span> <span class="id">REWRITE_WITNESS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">isGEPAtIx</span> <span class="kwd">in</span> <span class="id">REWRITE_WITNESS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">REWRITE_WITNESS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">REWRITE_WITNESS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">BLK_ID_SAME</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">blk_id</span> <span class="id">bold</span> == <span class="id">init</span> <span class="id">df_instrs</span>) <span class="kwd">as</span> [<span class="id">BLKID_INIT</span> |<span class="id">BLKID_NOINIT</span>].<br/>
<div class="doc">block id matches INIT *</div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span>  <span class="id">exec_new_program</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">exec_old_program</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="comment">(**&nbsp;block&nbsp;id&nbsp;does&nbsp;not&nbsp;match&nbsp;INIT&nbsp;**)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;- <span class="comment">(**&nbsp;NO&nbsp;FUNCTION&nbsp;**)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">FINDFN_REWRITE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">FINDFN_REWRITE</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">euttnorm</span>.<br/>
Qed.</div>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
