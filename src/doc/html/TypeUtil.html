<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module TypeUtil</title>
<meta name="description" content="Documentation of Coq module TypeUtil" />
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="hideAll('proofscript')">
<h1 class="title">Module TypeUtil</h1>
<div class="coq">
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">List</span> <span class="id">String</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.Util</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.LLVMAst</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.AstLib</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.LLVMIO</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Vellvm.Classes</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coqlib</span>.<br/>
<span class="kwd">Require</span> <span class="kwd">Import</span> <span class="id">Coq.Logic.FunctionalExtensionality</span>.<br/>
<br/>
<br/>
<span class="kwd">Import</span> <span class="id">ListNotations</span>.<br/>
<span class="kwd">Open</span> <span class="kwd">Scope</span> <span class="id">list_scope</span>.<br/>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">contra</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">try</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [<span class="id">Heq</span> : ?<span class="id">x</span> = ?<span class="id">y</span>, <span class="id">Hneq</span> : ?<span class="id">y</span> &lt;&gt; ?<span class="id">x</span> |- <span class="id">_</span>] =&gt; <span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Heq</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>; <span class="id">contradiction</span>.<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">sized_typ</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>) -&gt; <span class="id">typ</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">sized_typ_I</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">sz</span> : <span class="id">int</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sized_typ</span> <span class="id">defs</span> (<span class="id">TYPE_I</span> <span class="id">sz</span>)<br/>
<br/>
| <span class="id">sized_typ_Pointer</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sized_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Pointer</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">sized_typ_Half</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">TYPE_Half</span><br/>
<br/>
| <span class="id">sized_typ_Float</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">TYPE_Float</span><br/>
<br/>
| <span class="id">sized_typ_Double</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">TYPE_Double</span><br/>
<br/>
| <span class="id">sized_typ_X86_fp80</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">TYPE_X86_fp80</span><br/>
<br/>
| <span class="id">sized_typ_Fp128</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">TYPE_Fp128</span><br/>
<br/>
| <span class="id">sized_typ_Ppc_fp128</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">TYPE_Ppc_fp128</span><br/>
<br/>
| <span class="id">sized_typ_Metadata</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">TYPE_Metadata</span><br/>
<br/>
| <span class="id">sized_typ_X86_mmx</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">TYPE_X86_mmx</span><br/>
<br/>
| <span class="id">sized_typ_Array</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">sz</span> : <span class="id">int</span>) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">t</span> -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Array</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">sized_typ_Struct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">fields</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">f</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">f</span>) -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Struct</span> <span class="id">fields</span>)<br/>
<br/>
| <span class="id">sized_typ_Packed_struct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">fields</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">f</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">f</span>) -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Packed_struct</span> <span class="id">fields</span>)<br/>
<br/>
| <span class="id">sized_typ_Vector</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">sz</span> : <span class="id">int</span>) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">t</span> -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Vector</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">sized_typ_Identified</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">id</span> : <span class="id">ident</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> (<span class="id">t</span> : <span class="id">typ</span>), <span class="id">In</span> (<span class="id">id</span>, <span class="id">t</span>) <span class="id">defs</span> -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">t</span>) -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Identified</span> <span class="id">id</span>)<br/>
.<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">element_typ</span> : <span class="id">typ</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">element_typ_Pointer</span> : <span class="kwd">forall</span> (<span class="id">t</span> : <span class="id">typ</span>), <span class="id">element_typ</span> (<span class="id">TYPE_Pointer</span> <span class="id">t</span>)<br/>
| <span class="id">element_typ_I</span> : <span class="kwd">forall</span> (<span class="id">sz</span> : <span class="id">int</span>), <span class="id">element_typ</span> (<span class="id">TYPE_I</span> <span class="id">sz</span>)<br/>
| <span class="id">element_typ_Half</span> : <span class="id">element_typ</span> <span class="id">TYPE_Half</span><br/>
| <span class="id">element_typ_Float</span> : <span class="id">element_typ</span> <span class="id">TYPE_Float</span><br/>
| <span class="id">element_typ_Double</span> : <span class="id">element_typ</span> <span class="id">TYPE_Double</span><br/>
| <span class="id">element_typ_X86_fp80</span> : <span class="id">element_typ</span> <span class="id">TYPE_X86_fp80</span><br/>
| <span class="id">element_typ_Fp128</span> : <span class="id">element_typ</span> <span class="id">TYPE_Fp128</span><br/>
| <span class="id">element_typ_Ppc_fp128</span> : <span class="id">element_typ</span> <span class="id">TYPE_Ppc_fp128</span><br/>
.<br/>
&nbsp;&nbsp;<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">guarded_typ</span> : <span class="id">ident</span> -&gt; <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>) -&gt; <span class="id">typ</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">guarded_typ_I</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">sz</span> : <span class="id">int</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> (<span class="id">TYPE_I</span> <span class="id">sz</span>)<br/>
<br/>
| <span class="id">guarded_typ_Pointer</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> (<span class="id">TYPE_Pointer</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">guarded_typ_Void</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">TYPE_Void</span><br/>
<br/>
| <span class="id">guarded_typ_Half</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">TYPE_Half</span><br/>
<br/>
| <span class="id">guarded_typ_Float</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">TYPE_Float</span><br/>
<br/>
| <span class="id">guarded_typ_Double</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">TYPE_Double</span><br/>
<br/>
| <span class="id">guarded_typ_X86_fp80</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">TYPE_X86_fp80</span><br/>
<br/>
| <span class="id">guarded_typ_Fp128</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">TYPE_Fp128</span><br/>
<br/>
| <span class="id">guarded_typ_Ppc_fp128</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">TYPE_Ppc_fp128</span><br/>
<br/>
| <span class="id">guarded_typ_Metadata</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">TYPE_Metadata</span><br/>
<br/>
| <span class="id">guarded_typ_X86_mmx</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">TYPE_X86_mmx</span><br/>
<br/>
| <span class="id">guarded_typ_Function</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">ret</span> : <span class="id">typ</span>) (<span class="id">args</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">ret</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id">In</span> <span class="id">a</span> <span class="id">args</span> -&gt; <span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> (<span class="id">TYPE_Function</span> <span class="id">ret</span> <span class="id">args</span>)<br/>
<br/>
| <span class="id">guarded_typ_Array</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">sz</span> : <span class="id">int</span>) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">t</span> -&gt; <span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> (<span class="id">TYPE_Array</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">guarded_typ_Struct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">t</span> : <span class="id">typ</span>) (<span class="id">fields</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">f</span>, <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> (<span class="id">TYPE_Struct</span> <span class="id">fields</span>)<br/>
<br/>
| <span class="id">guarded_typ_Packed_struct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">t</span> : <span class="id">typ</span>) (<span class="id">fields</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">f</span>, <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> (<span class="id">TYPE_Packed_struct</span> <span class="id">fields</span>)<br/>
<br/>
| <span class="id">guarded_typ_Opaque</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">TYPE_Opaque</span><br/>
<br/>
| <span class="id">guarded_typ_Vector</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">sz</span> : <span class="id">int</span>) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> (<span class="id">TYPE_Vector</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">guarded_typ_Identified_Some</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">id</span>' : <span class="id">ident</span>) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">id</span> &lt;&gt; <span class="id">id</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Some</span> (<span class="id">id</span>', <span class="id">t</span>) = <span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span>' (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span>' <span class="id">env</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> (<span class="id">TYPE_Identified</span> <span class="id">id</span>')<br/>
<br/>
| <span class="id">guarded_typ_Identified_None</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">id</span> : <span class="id">ident</span>) (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">id</span>' : <span class="id">ident</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">id</span> &lt;&gt; <span class="id">id</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">None</span> = <span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span>' (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> (<span class="id">TYPE_Identified</span> <span class="id">id</span>')<br/>
.<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">first_class_typ</span> : <span class="id">typ</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">first_class_I</span> : <span class="kwd">forall</span> <span class="id">sz</span>, <span class="id">first_class_typ</span> (<span class="id">TYPE_I</span> <span class="id">sz</span>)<br/>
| <span class="id">first_class_Pointer</span> : <span class="kwd">forall</span> <span class="id">t</span>, <span class="id">first_class_typ</span> (<span class="id">TYPE_Pointer</span> <span class="id">t</span>)<br/>
| <span class="id">first_class_Void</span> : <span class="id">first_class_typ</span> <span class="id">TYPE_Void</span><br/>
| <span class="id">first_class_Half</span> : <span class="id">first_class_typ</span> <span class="id">TYPE_Half</span><br/>
| <span class="id">first_class_Float</span> : <span class="id">first_class_typ</span> <span class="id">TYPE_Float</span><br/>
| <span class="id">first_class_Double</span> : <span class="id">first_class_typ</span> <span class="id">TYPE_Double</span><br/>
| <span class="id">first_class_X86_fp80</span> : <span class="id">first_class_typ</span> <span class="id">TYPE_X86_fp80</span><br/>
| <span class="id">first_class_Fp128</span> : <span class="id">first_class_typ</span> <span class="id">TYPE_Fp128</span><br/>
| <span class="id">first_class_Ppc_fp128</span> : <span class="id">first_class_typ</span> <span class="id">TYPE_Ppc_fp128</span><br/>
| <span class="id">first_class_Metadata</span> : <span class="id">first_class_typ</span> <span class="id">TYPE_Metadata</span><br/>
| <span class="id">first_class_X86_mmx</span> : <span class="id">first_class_typ</span> <span class="id">TYPE_X86_mmx</span><br/>
| <span class="id">first_class_Array</span> : <span class="kwd">forall</span> <span class="id">sz</span> <span class="id">t</span>, <span class="id">first_class_typ</span> (<span class="id">TYPE_Array</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
| <span class="id">first_class_Struct</span> : <span class="kwd">forall</span> <span class="id">fields</span>, <span class="id">first_class_typ</span> (<span class="id">TYPE_Struct</span> <span class="id">fields</span>)<br/>
| <span class="id">first_class_Packed_struct</span> : <span class="kwd">forall</span> <span class="id">fields</span>, <span class="id">first_class_typ</span> (<span class="id">TYPE_Packed_struct</span> <span class="id">fields</span>)<br/>
| <span class="id">first_class_Opaque</span> : <span class="id">first_class_typ</span> <span class="id">TYPE_Opaque</span><br/>
| <span class="id">first_class_Vector</span> : <span class="kwd">forall</span> <span class="id">sz</span> <span class="id">t</span>, <span class="id">first_class_typ</span> (<span class="id">TYPE_Vector</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
| <span class="id">first_class_Identified</span> : <span class="kwd">forall</span> <span class="id">id</span>, <span class="id">first_class_typ</span> (<span class="id">TYPE_Identified</span> <span class="id">id</span>)<br/>
.<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">function_ret_typ</span> (<span class="id">t</span> : <span class="id">typ</span>) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">first_class_typ</span> <span class="id">t</span> /\ <span class="id">t</span> &lt;&gt; <span class="id">TYPE_Metadata</span>.<br/>
<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">wf_typ</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>) -&gt; <span class="id">typ</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">wf_typ_Pointer</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">t</span> -&gt; <span class="id">wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Pointer</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">wf_typ_I</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">sz</span> : <span class="id">int</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sz</span> &gt; 0 -&gt; <span class="id">wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_I</span> <span class="id">sz</span>)<br/>
<br/>
| <span class="id">wf_typ_Void</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Void</span><br/>
<br/>
| <span class="id">wf_typ_Half</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Half</span><br/>
<br/>
| <span class="id">wf_typ_Float</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Float</span><br/>
<br/>
| <span class="id">wf_typ_Double</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Double</span><br/>
<br/>
| <span class="id">wf_typ_X86_fp80</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_X86_fp80</span><br/>
<br/>
| <span class="id">wf_typ_Fp128</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Fp128</span><br/>
<br/>
| <span class="id">wf_typ_Ppc_fp128</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Ppc_fp128</span><br/>
<br/>
| <span class="id">wf_typ_Metadata</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Metadata</span><br/>
<br/>
| <span class="id">wf_typ_X86_mmx</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_X86_mmx</span><br/>
<br/>
| <span class="id">wf_typ_Function</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">ret</span> : <span class="id">typ</span>) (<span class="id">args</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">function_ret_typ</span> <span class="id">ret</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">ret</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">a</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">a</span> <span class="id">args</span> -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">a</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">a</span> <span class="id">args</span> -&gt; <span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Function</span> <span class="id">ret</span> <span class="id">args</span>)<br/>
<br/>
| <span class="id">wf_typ_Array</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">sz</span> : <span class="id">int</span>) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sz</span> &gt;= 0 -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">t</span> -&gt; <span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">t</span> -&gt; <span class="id">wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Array</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">wf_typ_Vector</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">sz</span> : <span class="id">int</span>) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sz</span> &gt; 0 -&gt; <span class="id">element_typ</span> <span class="id">t</span> -&gt; <span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">t</span> -&gt; <span class="id">wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Vector</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">wf_typ_Identified</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">id</span> : <span class="id">ident</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">t</span>, <span class="id">In</span> (<span class="id">id</span>, <span class="id">t</span>) <span class="id">defs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">t</span> : <span class="id">typ</span>), <span class="id">In</span> (<span class="id">id</span>, <span class="id">t</span>) <span class="id">defs</span> -&gt; <span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">defs</span> <span class="id">t</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">t</span> : <span class="id">typ</span>), <span class="id">In</span> (<span class="id">id</span>, <span class="id">t</span>) <span class="id">defs</span> -&gt; <span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">t</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Identified</span> <span class="id">id</span>)<br/>
<br/>
| <span class="id">wf_typ_Struct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">fields</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">f</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">f</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Struct</span> <span class="id">fields</span>)<br/>
<br/>
| <span class="id">wf_typ_Packed_struct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">fields</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">f</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">f</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Packed_struct</span> <span class="id">fields</span>)<br/>
<br/>
| <span class="id">wf_typ_Opaque</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Opaque</span><br/>
.<br/>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">wf_typ</span>.<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">wf_env</span> (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) : <span class="kwd">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id">NoDup</span> (<span class="id">map</span> <span class="id">fst</span> <span class="id">env</span>) /\ <span class="id">Forall</span> (<span class="id">wf_typ</span> <span class="id">env</span>) (<span class="id">map</span> <span class="id">snd</span> <span class="id">env</span>).<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">guarded_wf_typ</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>) -&gt; <span class="id">typ</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">guarded_wf_typ_Pointer</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Pointer</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">guarded_wf_typ_I</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">sz</span> : <span class="id">int</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sz</span> &gt; 0 -&gt; <span class="id">guarded_wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_I</span> <span class="id">sz</span>)<br/>
<br/>
| <span class="id">guarded_wf_typ_Void</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Void</span><br/>
<br/>
| <span class="id">guarded_wf_typ_Half</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Half</span><br/>
<br/>
| <span class="id">guarded_wf_typ_Float</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Float</span><br/>
<br/>
| <span class="id">guarded_wf_typ_Double</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Double</span><br/>
<br/>
| <span class="id">guarded_wf_typ_X86_fp80</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_X86_fp80</span><br/>
<br/>
| <span class="id">guarded_wf_typ_Fp128</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Fp128</span><br/>
<br/>
| <span class="id">guarded_wf_typ_Ppc_fp128</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Ppc_fp128</span><br/>
<br/>
| <span class="id">guarded_wf_typ_Metadata</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Metadata</span><br/>
<br/>
| <span class="id">guarded_wf_typ_X86_mmx</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_X86_mmx</span><br/>
<br/>
| <span class="id">guarded_wf_typ_Function</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">ret</span> : <span class="id">typ</span>) (<span class="id">args</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">function_ret_typ</span> <span class="id">ret</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">ret</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">a</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">a</span> <span class="id">args</span> -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">a</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">a</span> <span class="id">args</span> -&gt; <span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Function</span> <span class="id">ret</span> <span class="id">args</span>)<br/>
<br/>
| <span class="id">guarded_wf_typ_Array</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">sz</span> : <span class="id">int</span>) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sz</span> &gt;= 0 -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">t</span> -&gt; <span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">t</span> -&gt; <span class="id">guarded_wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Array</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">guarded_wf_typ_Vector</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">sz</span> : <span class="id">int</span>) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">sz</span> &gt; 0 -&gt; <span class="id">element_typ</span> <span class="id">t</span> -&gt; <span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">t</span> -&gt; <span class="id">guarded_wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Vector</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">guarded_wf_typ_Identified</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">id</span> : <span class="id">ident</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">exists</span> <span class="id">t</span>, <span class="id">In</span> (<span class="id">id</span>, <span class="id">t</span>) <span class="id">defs</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">t</span> : <span class="id">typ</span>), <span class="id">In</span> (<span class="id">id</span>, <span class="id">t</span>) <span class="id">defs</span> -&gt; <span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">defs</span> <span class="id">t</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">t</span> : <span class="id">typ</span>), <span class="id">In</span> (<span class="id">id</span>, <span class="id">t</span>) <span class="id">defs</span> -&gt; <span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">t</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Identified</span> <span class="id">id</span>)<br/>
<br/>
| <span class="id">guarded_wf_typ_Struct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">fields</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">f</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">f</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Struct</span> <span class="id">fields</span>)<br/>
<br/>
| <span class="id">guarded_wf_typ_Packed_struct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">fields</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">f</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">sized_typ</span> <span class="id">defs</span> <span class="id">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> (<span class="id">f</span> : <span class="id">typ</span>), <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> (<span class="id">TYPE_Packed_struct</span> <span class="id">fields</span>)<br/>
<br/>
| <span class="id">guarded_wf_typ_Opaque</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">defs</span> <span class="id">TYPE_Opaque</span><br/>
.<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">guarded_wf_typ</span>.<br/>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">wf_typ_is_guarded_wf_typ</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">env</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">env</span> <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof167')">Proof.</div>
<div class="proofscript" id="proof167">
&nbsp;&nbsp;<span class="tactic">induction</span> 1; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">unrolled_typ</span> : <span class="id">typ</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">unrolled_typ_I</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">sz</span> : <span class="id">int</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> (<span class="id">TYPE_I</span> <span class="id">sz</span>)<br/>
<br/>
| <span class="id">unrolled_typ_Pointer</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> (<span class="id">TYPE_Pointer</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">unrolled_typ_Void</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> <span class="id">TYPE_Void</span><br/>
<br/>
| <span class="id">unrolled_typ_Half</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> <span class="id">TYPE_Half</span><br/>
<br/>
| <span class="id">unrolled_typ_Float</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> <span class="id">TYPE_Float</span><br/>
<br/>
| <span class="id">unrolled_typ_Double</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> <span class="id">TYPE_Double</span><br/>
<br/>
| <span class="id">unrolled_typ_X86_fp80</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> <span class="id">TYPE_X86_fp80</span><br/>
<br/>
| <span class="id">unrolled_typ_Fp128</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> <span class="id">TYPE_Fp128</span><br/>
<br/>
| <span class="id">unrolled_typ_Ppc_fp128</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> <span class="id">TYPE_Ppc_fp128</span><br/>
<br/>
| <span class="id">unrolled_typ_Metadata</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> <span class="id">TYPE_Metadata</span><br/>
<br/>
| <span class="id">unrolled_typ_X86_mmx</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> <span class="id">TYPE_X86_mmx</span><br/>
<br/>
| <span class="id">unrolled_typ_Array</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">sz</span> : <span class="id">int</span>) (<span class="id">t</span> : <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> (<span class="id">TYPE_Array</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
<br/>
| <span class="id">unrolled_typ_Function</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">ret</span> : <span class="id">typ</span>) (<span class="id">args</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> <span class="id">ret</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> <span class="id">unrolled_typ</span> <span class="id">args</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> (<span class="id">TYPE_Function</span> <span class="id">ret</span> <span class="id">args</span>)<br/>
<br/>
| <span class="id">unrolled_typ_Struct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fields</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> (<span class="id">unrolled_typ</span>) <span class="id">fields</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> (<span class="id">TYPE_Struct</span> <span class="id">fields</span>)<br/>
<br/>
| <span class="id">unrolled_typ_Packed_struct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">fields</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Forall</span> (<span class="id">unrolled_typ</span>) <span class="id">fields</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> (<span class="id">TYPE_Packed_struct</span> <span class="id">fields</span>)<br/>
<br/>
| <span class="id">unrolled_typ_Opaque</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> <span class="id">TYPE_Opaque</span><br/>
<br/>
| <span class="id">unrolled_typ_Vector</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">sz</span> : <span class="id">int</span>) (<span class="id">t</span> : <span class="id">typ</span>), <span class="id">unrolled_typ</span> (<span class="id">TYPE_Vector</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
.<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">typ_order</span> : <span class="id">typ</span> -&gt; <span class="id">typ</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">typ_order_Pointer</span> : <span class="kwd">forall</span> (<span class="id">t</span> : <span class="id">typ</span>), <span class="id">typ_order</span> <span class="id">t</span> (<span class="id">TYPE_Pointer</span> <span class="id">t</span>)<br/>
| <span class="id">typ_order_Array</span> : <span class="kwd">forall</span> (<span class="id">sz</span> : <span class="id">int</span>) (<span class="id">t</span> : <span class="id">typ</span>), <span class="id">typ_order</span> <span class="id">t</span> (<span class="id">TYPE_Array</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
| <span class="id">typ_order_Vector</span> : <span class="kwd">forall</span> (<span class="id">sz</span> : <span class="id">int</span>) (<span class="id">t</span> : <span class="id">typ</span>), <span class="id">typ_order</span> <span class="id">t</span> (<span class="id">TYPE_Vector</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
| <span class="id">typ_order_Struct</span> : <span class="kwd">forall</span> (<span class="id">fields</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>, <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">typ_order</span> <span class="id">f</span> (<span class="id">TYPE_Struct</span> <span class="id">fields</span>)<br/>
| <span class="id">typ_order_Packed_struct</span> : <span class="kwd">forall</span> (<span class="id">fields</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">f</span>, <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">typ_order</span> <span class="id">f</span> (<span class="id">TYPE_Packed_struct</span> <span class="id">fields</span>)<br/>
| <span class="id">typ_order_Function_args</span> : <span class="kwd">forall</span> (<span class="id">ret</span> : <span class="id">typ</span>) (<span class="id">args</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">a</span>, <span class="id">In</span> <span class="id">a</span> <span class="id">args</span> -&gt; <span class="id">typ_order</span> <span class="id">a</span> (<span class="id">TYPE_Function</span> <span class="id">ret</span> <span class="id">args</span>)<br/>
| <span class="id">typ_order_Function_ret</span> : <span class="kwd">forall</span> (<span class="id">ret</span> : <span class="id">typ</span>) (<span class="id">args</span> : <span class="id">list</span> <span class="id">typ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">typ_order</span> <span class="id">ret</span> (<span class="id">TYPE_Function</span> <span class="id">ret</span> <span class="id">args</span>)<br/>
.<br/>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">typ_order</span>.<br/>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">wf_typ_order</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">well_founded</span> <span class="id">typ_order</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof168')">Proof.</div>
<div class="proofscript" id="proof168">
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">well_founded</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">a</span> <span class="kwd">using</span> <span class="id">typ_ind</span>'; <span class="id">constructor</span>; <span class="tactic">intros</span> <span class="id">y</span> <span class="id">H</span>'; <span class="tactic">inversion</span> <span class="id">H</span>'; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">wf_lt_typ_order</span> :<br/>
&nbsp;&nbsp;<span class="id">well_founded</span> (<span class="id">lex_ord</span> <span class="id">lt</span> <span class="id">typ_order</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof169')">Proof.</div>
<div class="proofscript" id="proof169">
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">wf_lex_ord</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">lt_wf</span>. <span class="tactic">apply</span> <span class="id">wf_typ_order</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="kwd">Resolve</span> <span class="id">wf_lt_typ_order</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">lex_ord</span>.<br/>
<br/>
<br/>
<span class="kwd">Definition</span> <span class="id">length_order</span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">l1</span> <span class="id">l2</span> : <span class="id">list</span> <span class="id">A</span>) :=<br/>
&nbsp;&nbsp;(<span class="id">List.length</span> <span class="id">l1</span> &lt; <span class="id">List.length</span> <span class="id">l2</span>)%<span class="id">nat</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">lengthOrder_wf</span>' : <span class="kwd">forall</span> <span class="id">A</span> <span class="id">len</span>, <span class="kwd">forall</span> <span class="id">ls</span>, (<span class="id">List.length</span> <span class="id">ls</span> &lt;= <span class="id">len</span>)%<span class="id">nat</span> -&gt; <span class="id">Acc</span> (@<span class="id">length_order</span> <span class="id">A</span>) <span class="id">ls</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">length_order</span>; <span class="tactic">induction</span> <span class="id">len</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">ls</span> <span class="id">H</span>; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">subst</span>; <span class="id">constructor</span>; <span class="tactic">firstorder</span>.<br/>
Defined.</div>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">lengthOrder_wf</span> : <span class="kwd">forall</span> <span class="id">A</span>, <span class="id">well_founded</span> (@<span class="id">length_order</span> <span class="id">A</span>).<br/>
&nbsp;&nbsp;<span class="tactic">red</span>; <span class="tactic">intros</span> <span class="id">A</span> <span class="id">a</span>; <span class="tactic">eapply</span> <span class="id">lengthOrder_wf</span>'; <span class="tactic">eauto</span>.<br/>
Defined.</div>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">wf_length_typ_order</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">well_founded</span> (<span class="id">lex_ord</span> (@<span class="id">length_order</span> <span class="id">A</span>) <span class="id">typ_order</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof170')">Proof.</div>
<div class="proofscript" id="proof170">
&nbsp;&nbsp;<span class="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">wf_lex_ord</span>. <span class="tactic">apply</span> <span class="id">lengthOrder_wf</span>. <span class="tactic">apply</span> <span class="id">wf_typ_order</span>.<br/>
Defined.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">map_In</span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} (<span class="id">l</span> : <span class="id">list</span> <span class="id">A</span>) (<span class="id">f</span> : <span class="kwd">forall</span> (<span class="id">x</span> : <span class="id">A</span>), <span class="id">In</span> <span class="id">x</span> <span class="id">l</span> -&gt; <span class="id">B</span>) : <span class="id">list</span> <span class="id">B</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof171')">Proof.</div>
<div class="proofscript" id="proof171">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">exact</span> [].<br/>
&nbsp;&nbsp;- <span class="tactic">refine</span> (<span class="id">f</span> <span class="id">a</span> <span class="id">_</span> :: <span class="id">IHl</span> <span class="id">_</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intros</span> <span class="id">x</span> <span class="id">H</span>. <span class="tactic">apply</span> (<span class="id">f</span> <span class="id">x</span>). <span class="tactic">simpl</span>. <span class="tactic">auto</span>.<br/>
Defined.</div>
<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">remove_key</span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} (<span class="id">eq_dec</span> : (<span class="kwd">forall</span> (<span class="id">x</span> <span class="id">y</span> : <span class="id">A</span>), {<span class="id">x</span> = <span class="id">y</span>} + {<span class="id">x</span> &lt;&gt; <span class="id">y</span>})) (<span class="id">a</span> : <span class="id">A</span>) (<span class="id">l</span> : <span class="id">list</span> (<span class="id">A</span> * <span class="id">B</span>)) : <span class="id">list</span> (<span class="id">A</span> * <span class="id">B</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">l</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">nil</span><br/>
&nbsp;&nbsp;| <span class="id">cons</span> (<span class="id">h</span>, <span class="id">b</span>) <span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">eq_dec</span> <span class="id">a</span> <span class="id">h</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">left</span> <span class="id">_</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">right</span> <span class="id">_</span> =&gt; (<span class="id">h</span>, <span class="id">b</span>) :: <span class="id">remove_key</span> <span class="id">eq_dec</span> <span class="id">a</span> <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Fixpoint</span> <span class="id">remove_keys</span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} (<span class="id">eq_dec</span> : (<span class="kwd">forall</span> (<span class="id">x</span> <span class="id">y</span> : <span class="id">A</span>), {<span class="id">x</span> = <span class="id">y</span>} + {<span class="id">x</span> &lt;&gt; <span class="id">y</span>})) (<span class="id">keys</span> : <span class="id">list</span> <span class="id">A</span>) (<span class="id">l</span> : <span class="id">list</span> (<span class="id">A</span> * <span class="id">B</span>)) : <span class="id">list</span> (<span class="id">A</span> * <span class="id">B</span>) :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">keys</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">nil</span> =&gt; <span class="id">l</span><br/>
&nbsp;&nbsp;| <span class="id">key</span> :: <span class="id">rest_of_keys</span> =&gt; <span class="id">remove_keys</span> <span class="id">eq_dec</span> <span class="id">rest_of_keys</span> (<span class="id">remove_key</span> <span class="id">eq_dec</span> <span class="id">key</span> <span class="id">l</span>)<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">destruct_prod</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ |- <span class="id">context</span>[<span class="kwd">let</span> (<span class="id">_</span>, <span class="id">_</span>) := ?<span class="id">p</span> <span class="kwd">in</span> <span class="id">_</span>]] =&gt; <span class="tactic">destruct</span> <span class="id">p</span><br/>
&nbsp;&nbsp;| [ <span class="id">p</span>: ?<span class="id">A</span> * ?<span class="id">B</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">destruct</span> <span class="id">p</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">destruct_eq_dec</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">eq</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> : ?<span class="id">A</span> , {<span class="id">x</span> = <span class="id">y</span>} + {<span class="id">x</span> &lt;&gt; <span class="id">y</span>} |- <span class="id">context</span>[<span class="id">eq</span> ?<span class="id">a</span> ?<span class="id">b</span>] ] =&gt; <span class="tactic">destruct</span> (<span class="id">eq</span> <span class="id">a</span> <span class="id">b</span>) <span class="id">eqn</span>:?; <span class="tactic">simpl</span><br/>
&nbsp;&nbsp;| [ |- <span class="id">context</span>[<span class="id">Ident.eq_dec</span> ?<span class="id">a</span> ?<span class="id">b</span>] ] =&gt; <span class="tactic">destruct</span> (<span class="id">Ident.eq_dec</span> <span class="id">a</span> <span class="id">b</span>) <span class="id">eqn</span>:?; <span class="tactic">simpl</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">remove_key_in</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>) (<span class="id">a</span> : <span class="id">A</span>)  (<span class="id">b</span> : <span class="id">B</span>) <span class="id">eq_dec</span> <span class="id">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> (<span class="id">a</span>, <span class="id">b</span>) <span class="id">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">List.length</span> (<span class="id">remove_key</span> <span class="id">eq_dec</span> <span class="id">a</span> <span class="id">l</span>) &lt; <span class="id">List.length</span> <span class="id">l</span>)%<span class="id">nat</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof172')">Proof.</div>
<div class="proofscript" id="proof172">
&nbsp;&nbsp;<span class="tactic">induction</span> 0.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">H</span>. <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct_prod</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="id">destruct_eq_dec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">Nat.lt_succ_diag_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id">lt_n_S</span>. <span class="tactic">apply</span> <span class="id">IHl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">inversion</span> <span class="id">H</span>. <span class="tactic">subst</span>. <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">remove_key_not_in</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>) (<span class="id">a</span> : <span class="id">A</span>) <span class="id">eq_dec</span> (<span class="id">l</span> : <span class="id">list</span> (<span class="id">A</span> * <span class="id">B</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">In</span> <span class="id">a</span> (<span class="id">map</span> <span class="id">fst</span> <span class="id">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remove_key</span> <span class="id">eq_dec</span> <span class="id">a</span> <span class="id">l</span> = <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof173')">Proof.</div>
<div class="proofscript" id="proof173">
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">intros</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="id">destruct_prod</span>; <span class="id">destruct_eq_dec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">intuition</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">solve_eq_dec_if</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">eq</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> : ?<span class="id">A</span> , {<span class="id">x</span> = <span class="id">y</span>} + {<span class="id">x</span> &lt;&gt; <span class="id">y</span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Heq</span> : ?<span class="id">eq</span> ?<span class="id">a</span> ?<span class="id">b</span> = ?<span class="id">c</span> |- <span class="id">context</span>[<span class="kwd">if</span> ?<span class="id">eq</span> ?<span class="id">a</span> ?<span class="id">b</span> <span class="kwd">then</span> <span class="id">_</span> <span class="kwd">else</span> <span class="id">_</span>] ] =&gt; <span class="tactic">rewrite</span> <span class="id">Heq</span><br/>
&nbsp;&nbsp;| [ <span class="id">Heq</span> : <span class="id">Ident.eq_dec</span> ?<span class="id">a</span> ?<span class="id">b</span> = ?<span class="id">c</span> |- <span class="id">context</span>[<span class="kwd">if</span> <span class="id">Ident.eq_dec</span> ?<span class="id">a</span> ?<span class="id">b</span> <span class="kwd">then</span> <span class="id">_</span> <span class="kwd">else</span> <span class="id">_</span>] ] =&gt; <span class="tactic">rewrite</span> <span class="id">Heq</span><br/>
&nbsp;&nbsp;| [ <span class="id">eq</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> : ?<span class="id">A</span> , {<span class="id">x</span> = <span class="id">y</span>} + {<span class="id">x</span> &lt;&gt; <span class="id">y</span>},<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Heq</span> : ?<span class="id">eq</span> ?<span class="id">a</span> ?<span class="id">b</span> = ?<span class="id">c</span> |- <span class="id">context</span>[<span class="kwd">if</span> <span class="id">proj_sumbool</span> (?<span class="id">eq</span> ?<span class="id">a</span> ?<span class="id">b</span>) <span class="kwd">then</span> <span class="id">_</span> <span class="kwd">else</span> <span class="id">_</span>] ] =&gt; <span class="tactic">rewrite</span> <span class="id">Heq</span><br/>
&nbsp;&nbsp;| [ <span class="id">Heq</span> : <span class="id">Ident.eq_dec</span> ?<span class="id">a</span> ?<span class="id">b</span> = ?<span class="id">c</span> |- <span class="id">context</span>[<span class="kwd">if</span> <span class="id">proj_sumbool</span> (<span class="id">Ident.eq_dec</span> ?<span class="id">a</span> ?<span class="id">b</span>) <span class="kwd">then</span> <span class="id">_</span> <span class="kwd">else</span> <span class="id">_</span>] ] =&gt; <span class="tactic">rewrite</span> <span class="id">Heq</span><br/>
<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">subst_eq</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">eq</span>: <span class="kwd">forall</span> <span class="id">x</span> <span class="id">y</span> : ?<span class="id">A</span> , {<span class="id">x</span> = <span class="id">y</span>} + {<span class="id">x</span> &lt;&gt; <span class="id">y</span>}, <span class="id">Heq</span>: <span class="id">eq</span> ?<span class="id">a</span> ?<span class="id">b</span> = ?<span class="id">c</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">rewrite</span> <span class="id">Heq</span><br/>
&nbsp;&nbsp;| [ <span class="id">Heq</span> : <span class="id">Ident.eq_dec</span> ?<span class="id">a</span> ?<span class="id">b</span> = ?<span class="id">c</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">rewrite</span> <span class="id">Heq</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">solve_eq_dec</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">destruct_prod</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *;<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="id">destruct_eq_dec</span>; <span class="tactic">simpl</span> <span class="kwd">in</span> *; <span class="tactic">subst</span>; <span class="tactic">simpl</span>; <span class="tactic">try</span> <span class="id">contra</span>; <span class="tactic">auto</span>; <span class="tactic">repeat</span> (<span class="id">solve_eq_dec_if</span>; <span class="tactic">simpl</span>); <span class="tactic">auto</span>);<br/>
&nbsp;&nbsp;<span class="tactic">intuition</span>; <span class="tactic">try</span> <span class="tactic">congruence</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">remove_key_commutes</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>) (<span class="id">k1</span> <span class="id">k2</span> : <span class="id">A</span>) <span class="id">eq_dec</span> (<span class="id">l</span> : <span class="id">list</span> (<span class="id">A</span> * <span class="id">B</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remove_key</span> <span class="id">eq_dec</span> <span class="id">k1</span> (<span class="id">remove_key</span> <span class="id">eq_dec</span> <span class="id">k2</span> <span class="id">l</span>) = <span class="id">remove_key</span> <span class="id">eq_dec</span> <span class="id">k2</span> (<span class="id">remove_key</span> <span class="id">eq_dec</span> <span class="id">k1</span> <span class="id">l</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof174')">Proof.</div>
<div class="proofscript" id="proof174">
&nbsp;&nbsp;<span class="tactic">induction</span> 0; <span class="id">solve_eq_dec</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">remove_key_keys</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>) (<span class="id">keys</span> : <span class="id">list</span> <span class="id">A</span>) <span class="id">eq_dec</span> (<span class="id">key</span> : <span class="id">A</span>) (<span class="id">l</span> : <span class="id">list</span> (<span class="id">A</span> * <span class="id">B</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remove_key</span> <span class="id">eq_dec</span> <span class="id">key</span> (<span class="id">remove_keys</span> <span class="id">eq_dec</span> <span class="id">keys</span> <span class="id">l</span>) = <span class="id">remove_keys</span> <span class="id">eq_dec</span> (<span class="id">key</span> :: <span class="id">keys</span>) <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof175')">Proof.</div>
<div class="proofscript" id="proof175">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">keys</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">keys</span> <span class="kwd">as</span> [| <span class="id">k</span> <span class="id">keys</span>' <span class="id">IHkeys</span>]; <span class="tactic">intros</span> <span class="id">eq_dec</span> <span class="id">key</span> <span class="id">l</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHkeys</span>.<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="tactic">f_equal</span>; <span class="tactic">apply</span> <span class="id">remove_key_commutes</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">remove_keys_key</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> (<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>) (<span class="id">keys</span> : <span class="id">list</span> <span class="id">A</span>) <span class="id">eq_dec</span> (<span class="id">key</span> : <span class="id">A</span>) (<span class="id">l</span> : <span class="id">list</span> (<span class="id">A</span> * <span class="id">B</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">remove_keys</span> <span class="id">eq_dec</span> <span class="id">keys</span> (<span class="id">remove_key</span> <span class="id">eq_dec</span> <span class="id">key</span> <span class="id">l</span>) = <span class="id">remove_keys</span> <span class="id">eq_dec</span> (<span class="id">key</span> :: <span class="id">keys</span>) <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof176')">Proof.</div>
<div class="proofscript" id="proof176">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">keys</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">keys</span>; <span class="tactic">intros</span> <span class="id">eq_dec</span> <span class="id">key</span> <span class="id">l</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Fixpoint</span> <span class="id">normalize_type</span> (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">t</span> : <span class="id">typ</span>) {<span class="kwd">measure</span> (<span class="id">List.length</span> <span class="id">env</span>, <span class="id">t</span>) (<span class="id">lex_ord</span> <span class="id">lt</span> <span class="id">typ_order</span>)} : <span class="id">typ</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Array</span> <span class="id">sz</span> <span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nt</span> := <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TYPE_Array</span> <span class="id">sz</span> <span class="id">nt</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Function</span> <span class="id">ret</span> <span class="id">args</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nret</span> := (<span class="id">normalize_type</span> <span class="id">env</span> <span class="id">ret</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nargs</span> := <span class="id">map_In</span> <span class="id">args</span> (<span class="kwd">fun</span> <span class="id">t</span> <span class="id">_</span> =&gt; <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TYPE_Function</span> <span class="id">nret</span> <span class="id">nargs</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Struct</span> <span class="id">fields</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nfields</span> := <span class="id">map_In</span> <span class="id">fields</span> (<span class="kwd">fun</span> <span class="id">t</span> <span class="id">_</span> =&gt; <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TYPE_Struct</span> <span class="id">nfields</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Packed_struct</span> <span class="id">fields</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nfields</span> := <span class="id">map_In</span> <span class="id">fields</span> (<span class="kwd">fun</span> <span class="id">t</span> <span class="id">_</span> =&gt; <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TYPE_Packed_struct</span> <span class="id">nfields</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Vector</span> <span class="id">sz</span> <span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nt</span> := <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TYPE_Vector</span> <span class="id">sz</span> <span class="id">nt</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Identified</span> <span class="id">id</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">env</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">TYPE_Identified</span> <span class="id">id</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">_</span>, <span class="id">t</span>) =&gt; <span class="id">normalize_type</span> (<span class="id">remove_key</span> <span class="id">Ident.eq_dec</span> <span class="id">id</span> <span class="id">env</span>) <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_I</span> <span class="id">sz</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Pointer</span> <span class="id">t</span>' =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Void</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Half</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Float</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Double</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_X86_fp80</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Fp128</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Ppc_fp128</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Metadata</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_X86_mmx</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Opaque</span> =&gt; <span class="id">t</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof177')">Next Obligation.</div>
<div class="proofscript" id="proof177">
&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Heq_anonymous</span>. <span class="tactic">apply</span> <span class="id">find_some</span> <span class="kwd">in</span> <span class="id">Heq_anonymous</span>. <span class="tactic">destruct</span> <span class="id">Heq_anonymous</span> <span class="kwd">as</span> [<span class="id">Hin</span> <span class="id">Heqb_ident</span>].<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heqb_ident</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Ident.eq_dec</span> <span class="id">id</span> <span class="id">wildcard</span>'). <span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id">remove_key_in</span>. <span class="tactic">apply</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqb_ident</span>.<br/>
Defined.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">normalize_type_equation</span> : <span class="kwd">forall</span> <span class="id">env</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Array</span> <span class="id">sz</span> <span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nt</span> := <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TYPE_Array</span> <span class="id">sz</span> <span class="id">nt</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Function</span> <span class="id">ret</span> <span class="id">args</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nret</span> := (<span class="id">normalize_type</span> <span class="id">env</span> <span class="id">ret</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nargs</span> := <span class="id">map_In</span> <span class="id">args</span> (<span class="kwd">fun</span> <span class="id">t</span> <span class="id">_</span> =&gt; <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TYPE_Function</span> <span class="id">nret</span> <span class="id">nargs</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Struct</span> <span class="id">fields</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nfields</span> := <span class="id">map_In</span> <span class="id">fields</span> (<span class="kwd">fun</span> <span class="id">t</span> <span class="id">_</span> =&gt; <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TYPE_Struct</span> <span class="id">nfields</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Packed_struct</span> <span class="id">fields</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nfields</span> := <span class="id">map_In</span> <span class="id">fields</span> (<span class="kwd">fun</span> <span class="id">t</span> <span class="id">_</span> =&gt; <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TYPE_Packed_struct</span> <span class="id">nfields</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Vector</span> <span class="id">sz</span> <span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nt</span> := <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">TYPE_Vector</span> <span class="id">sz</span> <span class="id">nt</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Identified</span> <span class="id">id</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">opt</span> := <span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">env</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">opt</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">TYPE_Identified</span> <span class="id">id</span>   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">_</span>, <span class="id">t</span>) =&gt; <span class="id">normalize_type</span> (<span class="id">remove_key</span> <span class="id">Ident.eq_dec</span> <span class="id">id</span> <span class="id">env</span>) <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_I</span> <span class="id">sz</span> =&gt; <span class="id">TYPE_I</span> <span class="id">sz</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Pointer</span> <span class="id">t</span>' =&gt; <span class="id">TYPE_Pointer</span> <span class="id">t</span>'<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Void</span> =&gt; <span class="id">TYPE_Void</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Half</span> =&gt; <span class="id">TYPE_Half</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Float</span> =&gt; <span class="id">TYPE_Float</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Double</span> =&gt; <span class="id">TYPE_Double</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_X86_fp80</span> =&gt; <span class="id">TYPE_X86_fp80</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Fp128</span> =&gt; <span class="id">TYPE_Fp128</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Ppc_fp128</span> =&gt; <span class="id">TYPE_Ppc_fp128</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Metadata</span> =&gt; <span class="id">TYPE_Metadata</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_X86_mmx</span> =&gt; <span class="id">TYPE_X86_mmx</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Opaque</span> =&gt; <span class="id">TYPE_Opaque</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof178')">Proof.</div>
<div class="proofscript" id="proof178">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">t</span>.<br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">normalize_type</span>. <br/>
&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">normalize_type_func</span> <span class="tactic">at</span> 1.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Wf.WfExtensionality.fix_sub_eq_ext</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">t</span>; <span class="tactic">try</span> <span class="tactic">reflexivity</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">ident</span> * <span class="id">typ</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">env</span>).<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">p</span>; <span class="tactic">simpl</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">reflexivity</span>.<br/>
Defined.</div>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">unrolled_typ</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">find_in_wf_env</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">id</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">NoDup</span> (<span class="id">map</span> <span class="id">fst</span> <span class="id">env</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> (<span class="id">id</span>, <span class="id">t</span>) <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">ident</span> * <span class="id">typ</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">env</span> = <span class="id">Some</span> (<span class="id">id</span>, <span class="id">t</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof179')">Proof.</div>
<div class="proofscript" id="proof179">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">id</span> <span class="id">t</span> <span class="id">Hdup</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">env</span> <span class="kwd">as</span> [| [<span class="id">id</span>' <span class="id">t</span>'] <span class="id">env</span> <span class="id">IHenv</span>].<br/>
&nbsp;&nbsp;- <span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Hin</span> | <span class="id">Hin</span>]; <span class="tactic">try</span> <span class="tactic">inversion</span> <span class="id">Hin</span>; <span class="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="id">destruct_eq_dec</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="id">destruct_eq_dec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">inversion</span> <span class="id">Hdup</span>. <span class="tactic">subst</span>. <span class="tactic">apply</span> <span class="id">in_map</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">fst</span>) <span class="kwd">in</span> <span class="id">Hin</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">simpl</span>. <span class="tactic">inversion</span> <span class="id">Hdup</span>. <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">guarded_typ_id_same</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">id</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> (<span class="id">TYPE_Identified</span> <span class="id">id</span>) -&gt; <span class="id">False</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof180')">Proof.</div>
<div class="proofscript" id="proof180">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">id</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">H</span>; <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">find_different_key_from_removed</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">id</span> <span class="id">id</span>',<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">id</span> &lt;&gt; <span class="id">id</span>' -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">ident</span> * <span class="id">typ</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span>' (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">env</span> = <span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">ident</span> * <span class="id">typ</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span>' (<span class="id">fst</span> <span class="id">a</span>)) (<span class="id">remove_key</span> <span class="id">Ident.eq_dec</span> <span class="id">id</span> <span class="id">env</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof181')">Proof.</div>
<div class="proofscript" id="proof181">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">id</span> <span class="id">id</span>' <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">env</span>; <span class="id">solve_eq_dec</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">remove_keys_find</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">id</span> <span class="id">ids</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;~ <span class="id">In</span> <span class="id">id</span> <span class="id">ids</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">ident</span> * <span class="id">typ</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">env</span> = <span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">ident</span> * <span class="id">typ</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) (<span class="id">remove_keys</span> <span class="id">Ident.eq_dec</span> <span class="id">ids</span> <span class="id">env</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof182')">Proof.</div>
<div class="proofscript" id="proof182">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">id</span> <span class="id">ids</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">ids</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">rewrite</span> &lt;- <span class="id">remove_key_keys</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">find_different_key_from_removed</span> <span class="kwd">with</span> (<span class="id">id</span>:=<span class="id">a</span>); <span class="tactic">intuition</span>; <span class="tactic">subst</span>; <span class="tactic">intuition</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">solve_some</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: (?<span class="id">i1</span>, ?<span class="id">t1</span>) = (?<span class="id">i2</span>, ?<span class="id">t2</span>) |- ?<span class="id">F</span> (?<span class="id">i1</span>, ?<span class="id">t1</span>) = ?<span class="id">F</span> (?<span class="id">i2</span>, ?<span class="id">t2</span>) ] =&gt; <span class="tactic">inversion</span> <span class="id">H</span>; <span class="tactic">reflexivity</span><br/>
&nbsp;&nbsp;| [ <span class="id">Hdup</span> : <span class="id">NoDup</span> (?<span class="id">i</span> :: <span class="id">map</span> <span class="id">fst</span> ?<span class="id">env</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hin</span> : <span class="id">In</span> (?<span class="id">i</span>, ?<span class="id">t</span>) ?<span class="id">env</span> |- ?<span class="id">F</span> (?<span class="id">i</span>, ?<span class="id">t1</span>) = ?<span class="id">F</span> (?<span class="id">i</span>, ?<span class="id">t2</span>) ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hnin</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hdup</span>' := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hdup</span> <span class="kwd">as</span> [| ? ? <span class="id">Hnin</span> <span class="id">Hdup</span>']; <span class="tactic">subst</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>; <span class="tactic">apply</span> <span class="id">Hnin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> <span class="id">i</span> <span class="kwd">with</span> (<span class="id">fst</span> (<span class="id">i</span>, <span class="id">t</span>)) <span class="tactic">by</span> <span class="tactic">reflexivity</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">in_map</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;| [ <span class="id">Hin</span> : <span class="id">In</span> (?<span class="id">i</span>, ?<span class="id">t1</span>) ((?<span class="id">i</span>, ?<span class="id">t2</span>) :: ?<span class="id">env</span>) |- ?<span class="id">F</span> (?<span class="id">i</span>, ?<span class="id">t1</span>) = ?<span class="id">F</span> (?<span class="id">i</span>, ?<span class="id">t2</span>) ] =&gt; <span class="tactic">symmetry</span>; <span class="id">solve_some</span><br/>
&nbsp;&nbsp;| [ <span class="id">Hin</span> : <span class="id">In</span> (?<span class="id">i</span>, ?<span class="id">t2</span>) ((?<span class="id">i</span>, ?<span class="id">t1</span>) :: ?<span class="id">env</span>) |- ?<span class="id">F</span> (?<span class="id">i</span>, ?<span class="id">t1</span>) = ?<span class="id">F</span> (?<span class="id">i</span>, ?<span class="id">t2</span>) ] =&gt; <span class="tactic">inversion</span> <span class="id">Hin</span>; <span class="id">solve_some</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">solve_in</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">Hin</span>: <span class="id">In</span> (?<span class="id">id</span>, ?<span class="id">t</span>) ((?<span class="id">i</span>, ?<span class="id">t0</span>) :: ?<span class="id">env</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hneq</span>: ?<span class="id">id</span> &lt;&gt; ?<span class="id">i</span> |- <span class="id">In</span> (?<span class="id">id</span>, ?<span class="id">t</span>) ?<span class="id">env</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Htup</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hin</span> <span class="kwd">as</span> [<span class="id">Htup</span> | ?]; [&gt; <span class="tactic">inversion</span> <span class="id">Htup</span>; <span class="id">contra</span> | <span class="tactic">auto</span>]<br/>
<br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; (<span class="id">proj_sumbool</span> (?<span class="id">eq</span> ?<span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)))) ?<span class="id">env</span> = <span class="id">Some</span> (?<span class="id">i</span>, ?<span class="id">t</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|- <span class="id">In</span> (?<span class="id">id</span>, ?<span class="id">t</span>) ?<span class="id">env</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hfind</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">find_some</span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [? <span class="id">Hfind</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hfind</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Ident.eq_dec</span> <span class="id">id</span> <span class="id">i</span>) <span class="id">eqn</span>:?; <span class="tactic">subst</span>; <span class="tactic">intuition</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">find_some_id</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">id</span> <span class="id">p</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">NoDup</span> (<span class="id">map</span> <span class="id">fst</span> <span class="id">env</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> (<span class="id">id</span>, <span class="id">t</span>) <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">ident</span> * <span class="id">typ</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">env</span> = <span class="id">Some</span> <span class="id">p</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">ident</span> * <span class="id">typ</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">env</span> = <span class="id">Some</span> (<span class="id">id</span>, <span class="id">t</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof183')">Proof.</div>
<div class="proofscript" id="proof183">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">id</span> <span class="id">p</span> <span class="id">t</span> <span class="id">Hdup</span> <span class="id">Hin</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">env</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> <span class="id">a</span>. <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">destruct_eq_dec</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">subst</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hdup</span>. <span class="id">solve_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">simpl</span>. <span class="tactic">apply</span> <span class="id">IHenv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">inversion</span> <span class="id">Hdup</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id">solve_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">rewrite</span> <span class="id">Heqs</span> <span class="kwd">in</span> <span class="id">H</span>. <span class="tactic">simpl</span> <span class="kwd">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">assumption</span>.<br/>
Qed.</div>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">sized_typ</span>.<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">guarded_typ</span>.<br/>
<br/>
<br/>
<span class="kwd">Inductive</span> <span class="id">simple_typ</span> : <span class="id">typ</span> -&gt; <span class="kwd">Prop</span> :=<br/>
| <span class="id">simple_typ_I</span> : <span class="kwd">forall</span> <span class="id">sz</span>, <span class="id">simple_typ</span> (<span class="id">TYPE_I</span> <span class="id">sz</span>)<br/>
| <span class="id">simple_typ_Pointer</span> : <span class="kwd">forall</span> <span class="id">t</span>, <span class="id">simple_typ</span> <span class="id">t</span> -&gt; <span class="id">simple_typ</span> (<span class="id">TYPE_Pointer</span> <span class="id">t</span>)<br/>
| <span class="id">simple_typ_Void</span> : <span class="id">simple_typ</span> (<span class="id">TYPE_Void</span>)<br/>
| <span class="id">simple_typ_Half</span> : <span class="id">simple_typ</span> (<span class="id">TYPE_Half</span>)<br/>
| <span class="id">simple_typ_Float</span> : <span class="id">simple_typ</span> (<span class="id">TYPE_Float</span>)<br/>
| <span class="id">simple_typ_Double</span> : <span class="id">simple_typ</span> (<span class="id">TYPE_Double</span>)<br/>
| <span class="id">simple_typ_X86_fp80</span> : <span class="id">simple_typ</span> (<span class="id">TYPE_X86_fp80</span>)<br/>
| <span class="id">simple_typ_Fp128</span> : <span class="id">simple_typ</span> (<span class="id">TYPE_Fp128</span>)<br/>
| <span class="id">simple_typ_Ppc_fp128</span> : <span class="id">simple_typ</span> (<span class="id">TYPE_Ppc_fp128</span>)<br/>
| <span class="id">simple_typ_Metadata</span> : <span class="id">simple_typ</span> (<span class="id">TYPE_Metadata</span>)<br/>
| <span class="id">simple_typ_X86_mmx</span> : <span class="id">simple_typ</span> (<span class="id">TYPE_X86_mmx</span>)<br/>
| <span class="id">simple_typ_Array</span> : <span class="kwd">forall</span> <span class="id">sz</span> <span class="id">t</span>, <span class="id">simple_typ</span> <span class="id">t</span> -&gt; <span class="id">simple_typ</span> (<span class="id">TYPE_Array</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
| <span class="id">simple_typ_Function</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">ret</span> <span class="id">args</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simple_typ</span> <span class="id">ret</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span>, <span class="id">In</span> <span class="id">a</span> <span class="id">args</span> -&gt; <span class="id">simple_typ</span> <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simple_typ</span> (<span class="id">TYPE_Function</span> <span class="id">ret</span> <span class="id">args</span>)<br/>
| <span class="id">simple_typ_Struct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fields</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">f</span>, <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">simple_typ</span> <span class="id">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simple_typ</span> (<span class="id">TYPE_Struct</span> <span class="id">fields</span>)<br/>
| <span class="id">simple_typ_Packed_struct</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">fields</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">f</span>, <span class="id">In</span> <span class="id">f</span> <span class="id">fields</span> -&gt; <span class="id">simple_typ</span> <span class="id">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simple_typ</span> (<span class="id">TYPE_Packed_struct</span> <span class="id">fields</span>)<br/>
| <span class="id">simple_typ_Opaque</span> : <span class="id">simple_typ</span> (<span class="id">TYPE_Opaque</span>)<br/>
| <span class="id">simple_typ_Vector</span> : <span class="kwd">forall</span> <span class="id">sz</span> <span class="id">t</span>, <span class="id">simple_typ</span> <span class="id">t</span> -&gt; <span class="id">simple_typ</span> (<span class="id">TYPE_Vector</span> <span class="id">sz</span> <span class="id">t</span>)<br/>
.<br/>
<br/>
<br/>
<span class="kwd">Hint</span> <span class="id">Constructors</span> <span class="id">simple_typ</span>.<br/>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">map_in_id</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">l</span> : <span class="id">list</span> <span class="id">A</span>) (<span class="id">f</span> : <span class="kwd">forall</span> <span class="id">x</span> : <span class="id">A</span>, <span class="id">In</span> <span class="id">x</span> <span class="id">l</span> -&gt; <span class="id">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">a</span> (<span class="id">Hin</span> : <span class="id">In</span> <span class="id">a</span> <span class="id">l</span>), <span class="id">f</span> <span class="id">a</span> <span class="id">Hin</span> = <span class="id">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">map_In</span> <span class="id">l</span> <span class="id">f</span> = <span class="id">l</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof184')">Proof.</div>
<div class="proofscript" id="proof184">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">l</span> <span class="id">f</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span>. <span class="tactic">rewrite</span> <span class="id">H</span>. <span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">simple_normalizes_to_self</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simple_typ</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span> = <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof185')">Proof.</div>
<div class="proofscript" id="proof185">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">t</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>; <span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>; <span class="tactic">simpl</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">_</span> = <span class="id">_</span> |- <span class="id">context</span>[<span class="id">normalize_type</span> <span class="id">_</span> <span class="id">_</span>]] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [|- <span class="id">context</span>[(<span class="id">map_In</span> <span class="id">_</span> (<span class="kwd">fun</span> (<span class="id">t</span> : <span class="id">typ</span>) (<span class="id">_</span> : <span class="id">In</span> <span class="id">t</span> <span class="id">_</span>) =&gt; <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>))]] =&gt; <span class="tactic">rewrite</span> <span class="id">map_in_id</span>; <span class="tactic">auto</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">simple_unrolled</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simple_typ</span> <span class="id">t</span> -&gt; <span class="id">unrolled_typ</span> <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof186')">Proof.</div>
<div class="proofscript" id="proof186">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">t</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">H</span>; <span class="id">constructor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [|- <span class="id">Forall</span> <span class="id">_</span> <span class="id">_</span>] =&gt; <span class="tactic">apply</span> <span class="id">Forall_forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">in_map_in</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> : <span class="kwd">Type</span>} (<span class="id">x</span> : <span class="id">A</span>) (<span class="id">l</span> : <span class="id">list</span> <span class="id">A</span>) <span class="id">f</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">In</span> <span class="id">x</span> (<span class="id">map_In</span> <span class="id">l</span> (<span class="kwd">fun</span> <span class="id">t</span> (<span class="id">_</span> : <span class="id">In</span> <span class="id">t</span> <span class="id">l</span>) =&gt; <span class="id">f</span> <span class="id">t</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">t</span>, <span class="id">In</span> <span class="id">t</span> <span class="id">l</span> /\ <span class="id">f</span> <span class="id">t</span> = <span class="id">x</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof187')">Proof.</div>
<div class="proofscript" id="proof187">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">x</span> <span class="id">l</span> <span class="id">f</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;- <span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">exists</span> <span class="id">a</span>. <span class="tactic">split</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">apply</span> <span class="id">IHl</span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">t</span> [<span class="id">Hin</span> <span class="id">Hftx</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exists</span> <span class="id">t</span>. <span class="tactic">intuition</span>.      <br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">map_rewrite</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> {<span class="id">A</span> <span class="id">B</span> : <span class="kwd">Type</span>} (<span class="id">x</span> : <span class="id">A</span>) (<span class="id">l</span> : <span class="id">list</span> <span class="id">A</span>) (<span class="id">f</span> <span class="id">g</span> : <span class="id">A</span> -&gt; <span class="id">B</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">x</span>, <span class="id">In</span> <span class="id">x</span> <span class="id">l</span> -&gt; <span class="id">f</span> <span class="id">x</span> = <span class="id">g</span> <span class="id">x</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">map_In</span> <span class="id">l</span> (<span class="kwd">fun</span> <span class="id">t</span> (<span class="id">_</span> : <span class="id">In</span> <span class="id">t</span> <span class="id">l</span>) =&gt; <span class="id">f</span> <span class="id">t</span>) = <span class="id">map_In</span> <span class="id">l</span> (<span class="kwd">fun</span> <span class="id">t</span> (<span class="id">_</span> : <span class="id">In</span> <span class="id">t</span> <span class="id">l</span>) =&gt; <span class="id">g</span> <span class="id">t</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof188')">Proof.</div>
<div class="proofscript" id="proof188">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">x</span> <span class="id">l</span> <span class="id">f</span> <span class="id">g</span> <span class="id">H</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span> <span class="kwd">as</span> [| <span class="id">a</span> <span class="id">l</span> <span class="id">IHl</span>]; <span class="tactic">simpl</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> (<span class="id">H</span> <span class="id">a</span>) <span class="kwd">as</span> <span class="id">Ha</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">Ha</span>; <span class="tactic">intuition</span>.<br/>
&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">IHl</span>; <span class="tactic">intuition</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">simpl_remove_keys</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ |- <span class="id">context</span>[<span class="id">remove_key</span> ?<span class="id">eq</span> ?<span class="id">id</span> (<span class="id">remove_keys</span> ?<span class="id">eq</span> ?<span class="id">ids</span> ?<span class="id">assoc_list</span>)] ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">remove_key</span> <span class="id">eq</span> <span class="id">id</span> (<span class="id">remove_keys</span> <span class="id">eq</span> <span class="id">ids</span> <span class="id">assoc_list</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">remove_keys</span> <span class="id">eq</span> (<span class="id">id</span> :: <span class="id">ids</span>) <span class="id">assoc_list</span>) <span class="tactic">by</span> <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">remove_key_keys</span><br/>
<br/>
&nbsp;&nbsp;| [ |- <span class="id">context</span>[<span class="id">remove_keys</span> ?<span class="id">eq</span> ?<span class="id">ids</span> (<span class="id">remove_key</span> ?<span class="id">eq</span> ?<span class="id">id</span> ?<span class="id">assoc_list</span>)] ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">remove_keys</span> <span class="id">eq</span> <span class="id">ids</span> (<span class="id">remove_key</span> <span class="id">eq</span> <span class="id">id</span> <span class="id">assoc_list</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">remove_keys</span> <span class="id">eq</span> (<span class="id">id</span> :: <span class="id">ids</span>) <span class="id">assoc_list</span>) <span class="tactic">by</span> <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">remove_keys_key</span><br/>
<br/>
&nbsp;&nbsp;| [ |- <span class="id">context</span>[<span class="id">remove_key</span> ?<span class="id">eq</span> ?<span class="id">id</span> ?<span class="id">assoc_list</span>] ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">remove_key</span> <span class="id">eq</span> <span class="id">id</span> <span class="id">assoc_list</span>) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">remove_keys</span> <span class="id">eq</span> [<span class="id">id</span>] <span class="id">assoc_list</span>) <span class="tactic">by</span> <span class="tactic">auto</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">subst_find_some</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">H1</span>: ?<span class="id">F</span> ?<span class="id">filter</span> ?<span class="id">defs</span> = ?<span class="id">G</span> (?<span class="id">i1</span>, ?<span class="id">t1</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">H2</span>: ?<span class="id">X</span> = ?<span class="id">F</span> ?<span class="id">filter</span> ?<span class="id">defs</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">rewrite</span> <span class="id">H1</span> <span class="kwd">in</span> <span class="id">H2</span>; <span class="tactic">inversion</span> <span class="id">H2</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">solve_guard</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">element_typ</span> ?<span class="id">x</span> |- <span class="id">guarded_typ</span> ?<span class="id">id</span> ?<span class="id">defs</span> ?<span class="id">x</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">element_typ</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">auto</span><br/>
<br/>
&nbsp;&nbsp;| [ <span class="id">Hguard</span>: <span class="kwd">forall</span> <span class="id">i</span>, <span class="id">In</span> <span class="id">i</span> ?<span class="id">ids</span> -&gt; <span class="id">guarded_typ</span> ?<span class="id">i</span> ?<span class="id">env</span> ?<span class="id">t</span> |- ~(<span class="id">In</span> ?<span class="id">id</span> ?<span class="id">ids</span>) ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hguard</span>' := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hin</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">not</span>; <span class="tactic">intros</span> <span class="id">Hin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">Hguard</span> <span class="id">id</span> <span class="id">Hin</span> <span class="kwd">as</span> <span class="id">Hguard</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hguard</span>'; <span class="tactic">auto</span><br/>
<br/>
&nbsp;&nbsp;| [ <span class="id">Hguard</span>: <span class="kwd">forall</span> <span class="id">t</span>, <span class="id">In</span> (?<span class="id">i</span>, <span class="id">t</span>) ?<span class="id">defs</span> -&gt; <span class="id">guarded_typ</span> ?<span class="id">i</span> ?<span class="id">defs</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hin</span>: <span class="id">In</span> ?<span class="id">id</span> [?<span class="id">i</span>] |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="tactic">inversion</span> <span class="id">Hin</span>; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">contradiction</span>; <span class="tactic">auto</span><br/>
<br/>
&nbsp;&nbsp;| [ <span class="id">Hguard</span>: <span class="kwd">forall</span> <span class="id">i</span>, <span class="id">In</span> ?<span class="id">id</span> [<span class="id">i</span>] -&gt; <span class="id">guarded_typ</span> ?<span class="id">i</span> ?<span class="id">env</span> ?<span class="id">t</span> |- ~(<span class="id">In</span> ?<span class="id">id</span> ?<span class="id">ids</span>) ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hguard</span>' := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hin</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">unfold</span> <span class="id">not</span>; <span class="tactic">intros</span> <span class="id">Hin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">Hguard</span> <span class="id">id</span> <span class="id">Hin</span> <span class="kwd">as</span> <span class="id">Hguard</span>';<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hguard</span>'; <span class="tactic">subst</span>; <span class="tactic">try</span> <span class="id">contra</span>; <span class="tactic">auto</span><br/>
<br/>
&nbsp;&nbsp;| [ <span class="id">Hguard</span>: <span class="kwd">forall</span> <span class="id">i</span>, <span class="id">In</span> <span class="id">i</span> ?<span class="id">ids</span> -&gt; <span class="id">guarded_typ</span> <span class="id">i</span> ?<span class="id">env</span> ?<span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hin</span>: <span class="id">In</span> ?<span class="id">id</span> [?<span class="id">one</span>] |- <span class="id">guarded_typ</span> ?<span class="id">id</span> ?<span class="id">defs</span> ?<span class="id">x</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hin</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>; <span class="id">contra</span><br/>
<br/>
&nbsp;&nbsp;| [ <span class="id">Hguard</span>: <span class="kwd">forall</span> <span class="id">i</span>, <span class="id">In</span> <span class="id">i</span> ?<span class="id">ids</span> -&gt; <span class="id">guarded_typ</span> <span class="id">i</span> ?<span class="id">env</span> ?<span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">Hin</span>: <span class="id">In</span> ?<span class="id">id</span> ?<span class="id">ids</span> |- <span class="id">guarded_typ</span> ?<span class="id">id</span> ?<span class="id">defs</span> ?<span class="id">x</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hguard</span>' := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span> <span class="id">proof</span> <span class="id">Hguard</span> <span class="id">_</span> <span class="id">Hin</span> <span class="kwd">as</span> <span class="id">Hguard</span>'; <span class="tactic">inversion</span> <span class="id">Hguard</span>'; <span class="tactic">auto</span>; <span class="tactic">subst</span>; <span class="id">subst_find_some</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span><br/>
<br/>
&nbsp;&nbsp;| [ |- <span class="kwd">forall</span> <span class="id">id</span>, <span class="id">In</span> <span class="id">id</span> ?<span class="id">ids</span> -&gt; <span class="id">guarded_typ</span> <span class="id">id</span> ?<span class="id">defs</span> ?<span class="id">x</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">intros</span>; <span class="id">solve_guard</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">guarded_id_normalize_same</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">NoDup</span> (<span class="id">map</span> <span class="id">fst</span> <span class="id">env</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">env</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ids</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">id</span>, <span class="id">In</span> <span class="id">id</span> <span class="id">ids</span> -&gt; <span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">t</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">normalize_type</span> (<span class="id">remove_keys</span> <span class="id">Ident.eq_dec</span> <span class="id">ids</span> <span class="id">env</span>) <span class="id">t</span> = <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof189')">Proof.</div>
<div class="proofscript" id="proof189">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">t</span> <span class="id">env</span> <span class="id">Hdup</span> <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hwf</span>; <span class="tactic">intros</span> <span class="id">ids</span> <span class="id">Hguard</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>; <span class="tactic">symmetry</span>; <span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">IHHwf</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [<span class="id">H</span> : <span class="id">element_typ</span> <span class="id">_</span> |- <span class="id">_</span>] =&gt; <span class="tactic">inversion</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">map_rewrite</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="id">normalize_type</span> (<span class="id">remove_keys</span> <span class="id">_</span> <span class="id">_</span> <span class="id">_</span>)) (<span class="id">g</span>:=<span class="id">normalize_type</span> <span class="id">defs</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">exact</span> (<span class="id">TYPE_Void</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>; <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">apply</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">auto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">intros</span> <span class="id">id</span> <span class="id">Hidin</span>; <span class="id">solve_guard</span>).<br/>
<br/>
&nbsp;Identifiers&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="id">simpl_remove_keys</span>.<br/>
<br/>
&nbsp;If&nbsp;id&nbsp;is&nbsp;in&nbsp;ids,&nbsp;this&nbsp;means&nbsp;that&nbsp;guarded_typ&nbsp;id&nbsp;defs<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(TYPE_Identified&nbsp;id),&nbsp;which&nbsp;is&nbsp;a&nbsp;contradiction.&nbsp;*)</span>&nbsp;&nbsp;<span class="tactic">assert</span> (~ <span class="id">In</span> <span class="id">id</span> <span class="id">ids</span>) <span class="kwd">as</span> <span class="id">Hnotin</span> <span class="tactic">by</span> <span class="id">solve_guard</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">replace</span> (<span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">ident</span> * <span class="id">typ</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) (<span class="id">remove_keys</span> <span class="id">Ident.eq_dec</span> <span class="id">ids</span> <span class="id">defs</span>)) <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">ident</span> * <span class="id">typ</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">defs</span>) <span class="tactic">by</span> (<span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">remove_keys_find</span>).<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">ident</span> * <span class="id">typ</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">defs</span>) <span class="id">eqn</span>:<span class="id">Hfind</span>; <span class="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id">destruct_prod</span>. <span class="tactic">simpl</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">assert</span> (<span class="id">In</span> (<span class="id">id</span>, <span class="id">t</span>) <span class="id">defs</span>).<br/>
&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">find_some</span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> [<span class="id">Hin</span> <span class="id">Hfind</span>].<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hfind</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Ident.eq_dec</span> <span class="id">id</span> <span class="id">i</span>) <span class="id">eqn</span>:<span class="id">Hidi</span>; <span class="tactic">subst</span>; <span class="tactic">intuition</span>.<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span> (<span class="id">simpl_remove_keys</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">repeat</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">rewrite</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">auto</span>); <span class="tactic">intros</span> <span class="id">id0</span> [<span class="id">Hidid0</span> | <span class="id">Hin</span>']; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
<br/>
&nbsp;&nbsp;- <span class="tactic">inversion</span> <span class="id">Hin</span>'.<br/>
&nbsp;&nbsp;- <span class="id">pose</span> <span class="id">proof</span> (<span class="id">Hguard</span> <span class="id">id0</span> <span class="id">Hin</span>') <span class="kwd">as</span> <span class="id">Hguard</span>'. <span class="tactic">inversion</span> <span class="id">Hguard</span>'; <span class="id">subst_find_some</span>; <span class="tactic">subst</span>; <span class="tactic">auto</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">double_map_In</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> (<span class="id">l</span> : <span class="id">list</span> <span class="id">A</span>) (<span class="id">f</span> : <span class="id">A</span> -&gt; <span class="id">B</span>) (<span class="id">g</span> : <span class="id">B</span> -&gt; <span class="id">C</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">map_In</span> (<span class="id">map_In</span> <span class="id">l</span> (<span class="kwd">fun</span> <span class="id">x</span> (<span class="id">_</span> : <span class="id">In</span> <span class="id">x</span> <span class="id">l</span>) =&gt; <span class="id">f</span> <span class="id">x</span>)) (<span class="kwd">fun</span> <span class="id">x</span> (<span class="id">_</span> : <span class="id">In</span> <span class="id">x</span> (<span class="id">map_In</span> <span class="id">l</span> (<span class="kwd">fun</span> <span class="id">x</span> (<span class="id">_</span> : <span class="id">In</span> <span class="id">x</span> <span class="id">l</span>) =&gt; <span class="id">f</span> <span class="id">x</span>))) =&gt; <span class="id">g</span> <span class="id">x</span>)) = <span class="id">map_In</span> <span class="id">l</span> (<span class="kwd">fun</span> <span class="id">x</span> (<span class="id">_</span> : <span class="id">In</span> <span class="id">x</span> <span class="id">l</span>) =&gt; <span class="id">g</span> (<span class="id">f</span> <span class="id">x</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof190')">Proof.</div>
<div class="proofscript" id="proof190">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">A</span> <span class="id">B</span> <span class="id">C</span> <span class="id">l</span> <span class="id">f</span> <span class="id">g</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">l</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="tactic">f_equal</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">solve_map_in</span> :=<br/>
&nbsp;&nbsp;<span class="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [  |- <span class="id">context</span>[<span class="id">map_In</span> (<span class="id">map_In</span> <span class="id">_</span> <span class="id">_</span>)] ] =&gt; <span class="tactic">rewrite</span> <span class="id">double_map_In</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>) |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">map_rewrite</span> <span class="kwd">with</span> (<span class="id">f</span>:=<span class="kwd">fun</span> <span class="id">x</span> =&gt; <span class="id">normalize_type</span> <span class="id">defs</span> (<span class="id">normalize_type</span> <span class="id">defs</span> <span class="id">x</span>)) (<span class="id">g</span>:=<span class="id">normalize_type</span> <span class="id">defs</span>); [&gt; <span class="tactic">eauto</span> | <span class="tactic">exact</span> <span class="id">TYPE_Void</span> | <span class="tactic">eauto</span>]);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">apply</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">auto</span>; <span class="id">solve_guard</span>]<br/>
<br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Ltac</span> <span class="id">solve_match_find</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| [ |- <span class="id">context</span>[<span class="kwd">match</span> ?<span class="id">Find</span> <span class="kwd">with</span> <span class="id">_</span> =&gt; <span class="id">_</span> <span class="kwd">end</span> = <span class="id">_</span>] ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">i</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">t</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">Hfind</span> := <span class="tactic">fresh</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">destruct</span> <span class="id">Find</span> <span class="kwd">as</span> [[<span class="id">i</span> <span class="id">t</span>] |] <span class="id">eqn</span>:<span class="id">Hfind</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id">Hf</span>: <span class="id">context</span>[<span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">proj_sumbool</span> (?<span class="id">eq</span> ?<span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>))) ?<span class="id">defs</span>],<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">defs</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>) |- <span class="id">_</span> ] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">assert</span> (<span class="id">In</span> (<span class="id">id</span>, <span class="id">t</span>) <span class="id">defs</span>) <span class="tactic">by</span> <span class="id">solve_in</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="id">simpl_remove_keys</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">guarded_id_normalize_same</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">wf_typ_is_guarded_wf_typ</span>; <span class="tactic">try</span> <span class="id">solve_guard</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">apply</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">auto</span>; <span class="id">solve_guard</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>; <span class="tactic">simpl</span>; <span class="tactic">rewrite</span> <span class="id">Hfind</span>; <span class="tactic">reflexivity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">guarded_normalize_same</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">t</span> <span class="id">env</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">NoDup</span> (<span class="id">map</span> <span class="id">fst</span> <span class="id">env</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">env</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ids</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">id</span>, <span class="id">In</span> <span class="id">id</span> <span class="id">ids</span> -&gt; <span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">t</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">normalize_type</span> <span class="id">env</span> (<span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>) = <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof191')">Proof.</div>
<div class="proofscript" id="proof191">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">t</span> <span class="id">env</span> <span class="id">Hdup</span> <span class="id">Hwf</span> <span class="id">ids</span> <span class="id">Hguard_all</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>; <span class="tactic">symmetry</span>; <span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">IHHwf</span>; <span class="tactic">auto</span>; <span class="tactic">try</span> <span class="id">solve_guard</span>; <span class="id">solve_map_in</span>].<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">solve_match_find</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Lemma</span> <span class="id">wf_typ_guarded_normalize_twice</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">NoDup</span> (<span class="id">map</span> <span class="id">fst</span> <span class="id">env</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">env</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ids</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">id</span>, <span class="id">In</span> <span class="id">id</span> <span class="id">ids</span> -&gt; <span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">t</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">normalize_type</span> <span class="id">env</span> (<span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>) = <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof192')">Proof.</div>
<div class="proofscript" id="proof192">
&nbsp;&nbsp;<span class="tactic">eauto</span> <span class="kwd">using</span> <span class="id">wf_typ_is_guarded_wf_typ</span>, <span class="id">guarded_normalize_same</span>.<br/>
Qed.</div>
<br/>
&nbsp;&nbsp;<br/>
<span class="kwd">Theorem</span> <span class="id">double_normalize_type</span> :<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_env</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">env</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">normalize_type</span> <span class="id">env</span> (<span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>) = <span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof193')">Proof.</div>
<div class="proofscript" id="proof193">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">t</span> [<span class="id">Hdup</span> <span class="id">Henv</span>] <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hwf</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">solve</span> [<span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>; <span class="tactic">symmetry</span>; <span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="tactic">rewrite</span> <span class="id">IHHwf</span>; <span class="tactic">auto</span>; <span class="tactic">try</span> <span class="id">solve_guard</span>; <span class="id">solve_map_in</span>].<br/>
<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span>; <span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>; <span class="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id">solve_match_find</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">guarded_normalize_type_unrolls</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">NoDup</span> (<span class="id">map</span> <span class="id">fst</span> <span class="id">env</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">guarded_wf_typ</span> <span class="id">env</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">ids</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="kwd">forall</span> <span class="id">id</span>, <span class="id">In</span> <span class="id">id</span> <span class="id">ids</span> -&gt; <span class="id">guarded_typ</span> <span class="id">id</span> <span class="id">env</span> <span class="id">t</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> (<span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>)).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof194')">Proof.</div>
<div class="proofscript" id="proof194">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">t</span> <span class="id">Hdup</span> <span class="id">Hwf</span> <span class="id">ids</span> <span class="id">Hguard_all</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hwf</span>; <span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">constructor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">IHHwf</span>; <span class="tactic">auto</span>; <span class="id">solve_guard</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">Forall_forall</span>; <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">In</span> ?<span class="id">x</span> (<span class="id">map_In</span> <span class="id">_</span> <span class="id">_</span>) |- <span class="id">_</span> ] =&gt;  <span class="tactic">apply</span> <span class="id">in_map_in</span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">t</span> [<span class="id">Hin</span> <span class="id">Hnorm</span>]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hnorm</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">apply</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">auto</span>; <span class="id">solve_guard</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">ident</span> * <span class="id">typ</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">defs</span>) <span class="kwd">as</span> [[<span class="id">i</span> <span class="id">t</span>] |] <span class="id">eqn</span>:<span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id">pose</span> <span class="id">proof</span> <span class="id">Hfind</span> <span class="kwd">as</span> <span class="id">Hfind</span>'.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">find_some</span> <span class="kwd">in</span> <span class="id">Hfind</span>' <span class="kwd">as</span> [<span class="id">Hin</span> <span class="id">Heq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> (<span class="id">Ident.eq_dec</span> <span class="id">id</span> <span class="id">i</span>) <span class="kwd">as</span> [<span class="id">He</span> | <span class="id">He</span>]; <span class="tactic">inversion</span> <span class="id">Heq</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">He</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_remove_keys</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">guarded_id_normalize_same</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">apply</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">subst</span>; <span class="tactic">auto</span>; <span class="id">solve_guard</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">t</span> <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">find_none</span> <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hfind</span>. <span class="tactic">destruct</span> (<span class="id">Ident.eq_dec</span> <span class="id">id</span> <span class="id">id</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hfind</span>. <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Theorem</span> <span class="id">normalize_type_unrolls</span>:<br/>
&nbsp;&nbsp;<span class="kwd">forall</span> <span class="id">env</span> <span class="id">t</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_env</span> <span class="id">env</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wf_typ</span> <span class="id">env</span> <span class="id">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">unrolled_typ</span> (<span class="id">normalize_type</span> <span class="id">env</span> <span class="id">t</span>).<br/>
<div class="toggleproof" onclick="toggleDisplay('proof195')">Proof.</div>
<div class="proofscript" id="proof195">
&nbsp;&nbsp;<span class="tactic">intros</span> <span class="id">env</span> <span class="id">t</span> [<span class="id">Hdup</span> <span class="id">Henv</span>] <span class="id">Hwf</span>.<br/>
&nbsp;&nbsp;<span class="tactic">induction</span> <span class="id">Hwf</span>; <span class="tactic">rewrite</span> <span class="id">normalize_type_equation</span>; <span class="tactic">simpl</span>; <span class="tactic">auto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> <span class="id">constructor</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">apply</span> <span class="id">IHHwf</span>; <span class="tactic">auto</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">try</span> (<span class="tactic">rewrite</span> <span class="id">Forall_forall</span>; <span class="tactic">intros</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">In</span> ?<span class="id">x</span> (<span class="id">map_In</span> <span class="id">_</span> <span class="id">_</span>) |- <span class="id">_</span> ] =&gt;  <span class="tactic">apply</span> <span class="id">in_map_in</span> <span class="kwd">in</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">t</span> [<span class="id">Hin</span> <span class="id">Hnorm</span>]]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> &lt;- <span class="id">Hnorm</span>;<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">goal</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [ <span class="id">H</span>: <span class="id">_</span> |- <span class="id">_</span> ] =&gt; <span class="tactic">apply</span> <span class="id">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span>; <span class="tactic">auto</span>; <span class="id">solve_guard</span>).<br/>
&nbsp;&nbsp;- <span class="tactic">destruct</span> (<span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> : <span class="id">ident</span> * <span class="id">typ</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">defs</span>) <span class="kwd">as</span> [[<span class="id">i</span> <span class="id">t</span>] |] <span class="id">eqn</span>:<span class="id">Hfind</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">apply</span> <span class="id">find_some</span> <span class="kwd">in</span> <span class="id">Hfind</span> <span class="kwd">as</span> [<span class="id">Hin</span> <span class="id">Heq</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> *. <span class="tactic">destruct</span> (<span class="id">Ident.eq_dec</span> <span class="id">id</span> <span class="id">i</span>); <span class="tactic">inversion</span> <span class="id">Heq</span>; <span class="tactic">subst</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">simpl_remove_keys</span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">rewrite</span> <span class="id">guarded_id_normalize_same</span>; <span class="tactic">auto</span> <span class="kwd">using</span> <span class="id">wf_typ_is_guarded_wf_typ</span>; <span class="id">solve_guard</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="tactic">destruct</span> <span class="id">H</span> <span class="kwd">as</span> [<span class="id">t</span> <span class="id">Hin</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">eapply</span> <span class="id">find_none</span> <span class="kwd">in</span> <span class="id">Hfind</span>; <span class="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Hfind</span>. <span class="tactic">destruct</span> (<span class="id">Ident.eq_dec</span> <span class="id">id</span> <span class="id">id</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Hfind</span>. <span class="id">contradiction</span>.<br/>
Qed.</div>
<br/>
<br/>
<span class="kwd">Program</span> <span class="kwd">Fixpoint</span> <span class="id">normalize_type_dtyp</span> (<span class="id">env</span> : <span class="id">list</span> (<span class="id">ident</span> * <span class="id">typ</span>)) (<span class="id">t</span> : <span class="id">typ</span>) {<span class="kwd">measure</span> (<span class="id">List.length</span> <span class="id">env</span>, <span class="id">t</span>) (<span class="id">lex_ord</span> <span class="id">lt</span> <span class="id">typ_order</span>)} : <span class="id">dtyp</span> :=<br/>
&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">t</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Array</span> <span class="id">sz</span> <span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nt</span> := <span class="id">normalize_type_dtyp</span> <span class="id">env</span> <span class="id">t</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">DTYPE_Array</span> <span class="id">sz</span> <span class="id">nt</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Function</span> <span class="id">ret</span> <span class="id">args</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">DTYPE_Pointer</span> <br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Struct</span> <span class="id">fields</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nfields</span> := <span class="id">map_In</span> <span class="id">fields</span> (<span class="kwd">fun</span> <span class="id">t</span> <span class="id">_</span> =&gt; <span class="id">normalize_type_dtyp</span> <span class="id">env</span> <span class="id">t</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">DTYPE_Struct</span> <span class="id">nfields</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Packed_struct</span> <span class="id">fields</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nfields</span> := <span class="id">map_In</span> <span class="id">fields</span> (<span class="kwd">fun</span> <span class="id">t</span> <span class="id">_</span> =&gt; <span class="id">normalize_type_dtyp</span> <span class="id">env</span> <span class="id">t</span>) <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">DTYPE_Packed_struct</span> <span class="id">nfields</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Vector</span> <span class="id">sz</span> <span class="id">t</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">nt</span> := <span class="id">normalize_type_dtyp</span> <span class="id">env</span> <span class="id">t</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">DTYPE_Vector</span> <span class="id">sz</span> <span class="id">nt</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_Identified</span> <span class="id">id</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">let</span> <span class="id">opt</span> := <span class="id">find</span> (<span class="kwd">fun</span> <span class="id">a</span> =&gt; <span class="id">Ident.eq_dec</span> <span class="id">id</span> (<span class="id">fst</span> <span class="id">a</span>)) <span class="id">env</span> <span class="kwd">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">match</span> <span class="id">opt</span> <span class="kwd">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">None</span> =&gt; <span class="id">DTYPE_Void</span>   <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id">Some</span> (<span class="id">_</span>, <span class="id">t</span>) =&gt; <span class="id">normalize_type_dtyp</span> (<span class="id">remove_key</span> <span class="id">Ident.eq_dec</span> <span class="id">id</span> <span class="id">env</span>) <span class="id">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="kwd">end</span><br/>
<br/>
&nbsp;&nbsp;| <span class="id">TYPE_I</span> <span class="id">sz</span> =&gt; <span class="id">DTYPE_I</span> <span class="id">sz</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Pointer</span> <span class="id">t</span>' =&gt; <span class="id">DTYPE_Pointer</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Void</span> =&gt; <span class="id">DTYPE_Void</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Half</span> =&gt; <span class="id">DTYPE_Half</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Float</span> =&gt; <span class="id">DTYPE_Float</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Double</span> =&gt; <span class="id">DTYPE_Double</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_X86_fp80</span> =&gt; <span class="id">DTYPE_X86_fp80</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Fp128</span> =&gt; <span class="id">DTYPE_Fp128</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Ppc_fp128</span> =&gt; <span class="id">DTYPE_Ppc_fp128</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Metadata</span> =&gt; <span class="id">DTYPE_Metadata</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_X86_mmx</span> =&gt; <span class="id">DTYPE_X86_mmx</span><br/>
&nbsp;&nbsp;| <span class="id">TYPE_Opaque</span> =&gt; <span class="id">DTYPE_Opaque</span><br/>
&nbsp;&nbsp;<span class="kwd">end</span>.<br/>
<div class="toggleproof" onclick="toggleDisplay('proof196')">Next Obligation.</div>
<div class="proofscript" id="proof196">
&nbsp;&nbsp;<span class="id">left</span>.<br/>
&nbsp;&nbsp;<span class="tactic">symmetry</span> <span class="kwd">in</span> <span class="id">Heq_opt</span>. <span class="tactic">apply</span> <span class="id">find_some</span> <span class="kwd">in</span> <span class="id">Heq_opt</span>. <span class="tactic">destruct</span> <span class="id">Heq_opt</span> <span class="kwd">as</span> [<span class="id">Hin</span> <span class="id">Heqb_ident</span>].<br/>
&nbsp;&nbsp;<span class="tactic">simpl</span> <span class="kwd">in</span> <span class="id">Heqb_ident</span>.<br/>
&nbsp;&nbsp;<span class="tactic">destruct</span> (<span class="id">Ident.eq_dec</span> <span class="id">id</span> <span class="id">wildcard</span>'). <span class="tactic">subst</span>. <span class="tactic">eapply</span> <span class="id">remove_key_in</span>. <span class="tactic">apply</span> <span class="id">Hin</span>.<br/>
&nbsp;&nbsp;<span class="tactic">inversion</span> <span class="id">Heqb_ident</span>.<br/>
Defined.</div>
</div>
<div class="footer"><hr/>Generated by coq2html</div>
</body>
</html>
